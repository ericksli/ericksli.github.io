<!doctype html><html lang=zh-tw dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>2021 iThome 鐵人賽「寫一個列車抵站時間 Android App」文章目錄 | EricLog</title>
<meta name=keywords content><meta name=description content="以下是我參加 2021 iThome 鐵人賽 所寫的系列文章「寫一個列車抵站時間 Android App」的目錄。原文在 iThome 首次發表，在完賽後轉貼到這裏。
文章示範的 code 可以在 GitHub repo 找到。


Intro
簡單的開場白，介紹將會提及的內容。
Architecture
Architecture Components (MVVM)、Modularization 和這次示範 app 所用的 architecture。
Endpoint
示範 app 會用到的 API endpoint 和 API response 對應的 data class。
Deserialization
比較 Gson、Moshi、Kotlin Serialization，並為上篇準備的 data class 加上 Kotlin Serialization 的 annotation。
Dependency injection
為 project 加入 Dagger Hilt。
HTTP Client
Ktor client 簡介、基本用法及把 Ktor client 加進 Dagger dependency graph。當中提及 @Inject、@InstallIn、@Singleton 及 @BindsOptionalOf 用法。
Data layer implementation (1)
車站及路綫 enum、domain layer repository interface、實作接駁 API endpoint、Dagger @Binds 用法及 Ktor client 跟 Retrofit 比較。
Data layer implementation (2)
API response data class 轉換到 domain layer data class 的 mapper。
Date & time
討論為甚麼要用 Java Time 而不是用 JDK 傳統的 Calendar、Date 的原因、為 project 加入 desugering library 及介紹 Time Zone Database。
Data layer testing (1)
JUnit 4 test、MockK 及 Strikt 基本用法。
Data layer testing (2)
用 Strikt 為 object 每個 property 做 assertion。
Data layer testing (3)
Ktor client 搭配 logback-android 在 unit test 時出現錯誤的解決方法、運用 Ktor mock engine 模擬 server response。
Data layer testing (4)
運用上篇的 Ktor mock engine 測試觸發 HTTP request 的 code 和經過 Kotlin Serialization deserialize 後的 response object 是否合符預期，另加 Strikt 自定義的 assertion。
Flipper
安裝 Flipper（只在 debug build type 才安裝）、Dagger Hilt 的 @HiltAndroidApp 及 @ApplicationContext 用法、Dagger @Qualifier 及 @BindsOptionalOf 用法、OkHttp client 加入 interceptor。
Domain layer implementation
實作 use case。
Domain layer testing
Use case 的 unit test。
Navigation (1)
安裝 Navigation component，準備將會用到的 Fragment 和 layout XML 檔案、簡單介紹 Dagger Hilt 的 @AndroidEntryPoint 及在 Fragment 使用 data binding 時要注意的地方。
Navigation (2)
定義 Navigation graph 並設定轉頁的參數、設定 MainActivity 以顯示 navigation graph 的頁面及使用轉頁參數時要注意的地方。
Station list screen (1)
實作車站列表頁介面，使用了 RecyclerView 的 ListAdapter、DiffUtil、data binding，並示範了 Dagger Hilt 的 @ActivityScoped 用法。
Station list screen (2)
實作車站列表頁的 ViewModel，示範了 Dagger Hilt 的 @HiltViewModel、Kotlin Flow 的 Channel、StateFlow/MutableStateFlow、combine、repeatOnLifecycle 用法和 Navigation component 防止用戶快速連按轉頁按鈕導致 crash 的方法。
ETA screen (1)
介紹抵站時間頁的流程，實作頁面基本的 layout XML、RecyclerView、ViewModel 及 onBackPressedDispatcher，另外亦示範了 Kotlin Sequence。
Whistle proxy
安裝 Whistle proxy、Whistle proxy 基本用法、在 Android 裝置安裝根證書、設定 network security configuration 及介紹 Proxy Toggle。
ETA screen (2)
SavedStateHandle 用法及以 Kotlin Flow 控制各式錯誤介面顯示。
ETA screen (3)
自動更新班次，介紹 Kotlin Coroutine 的 CoroutineScope、Job、delay 用法並使用 Java Time 的 Clock 取得當前時間。
ETA screen (4)
顯示錯誤 banner，介紹 Kotlin Coroutine 的 scan (runningFold) 用法，順帶講解 Kotlin Collection 的 fold 和 reduce。
Station list screen testing
安裝 Robolectric，為引用了 Android Context 的 class 寫 unit test；針對 Flipper 在 unit test 時報錯的解決方法；替換 Dispatchers.Main 及運用 Turbine 測試 Flow。
ETA screen testing (1)
示範 JUnit 4 parameterized test；介紹 cold flow (StateFlow) 跟 hot flow (SharedFlow) 的分別。
ETA screen testing (2)
運用 ThreeTen-Extra 提供的 MutableClock 及 Kotlin Coroutine 的 DelayController 改變時間並測試自動更新班次的邏輯。
Leftover topics
Two-way data binding、RecyclerView 局部更新、unidirectional data flow、instrumentation test 及 Coroutine dispatcher。
Wrapping up
參賽總結。
"><meta name=author content><link rel=canonical href=https://eric.swiftzer.net/2021-ithome-ironman/><link crossorigin=anonymous href=/assets/css/stylesheet.6af4cf50660ceaa7cb5315be4c4bf349a5f8e72eee8939bab4dd32dcf0378f25.css integrity="sha256-avTPUGYM6qfLUxW+TEvzSaX45y7uiTm6tN0y3PA3jyU=" rel="preload stylesheet" as=style><link rel=icon href=https://eric.swiftzer.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://eric.swiftzer.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://eric.swiftzer.net/favicon-32x32.png><link rel=apple-touch-icon href=https://eric.swiftzer.net/apple-touch-icon.png><link rel=mask-icon href=https://eric.swiftzer.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-tw href=https://eric.swiftzer.net/2021-ithome-ironman/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=JetBrains+Mono:wght@300&display=swap" rel=stylesheet><script async src="https://www.googletagmanager.com/gtag/js?id=G-D93F946T73"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-D93F946T73")}</script><meta property="og:url" content="https://eric.swiftzer.net/2021-ithome-ironman/"><meta property="og:site_name" content="EricLog"><meta property="og:title" content="2021 iThome 鐵人賽「寫一個列車抵站時間 Android App」文章目錄"><meta property="og:description" content="以下是我參加 2021 iThome 鐵人賽 所寫的系列文章「寫一個列車抵站時間 Android App」的目錄。原文在 iThome 首次發表，在完賽後轉貼到這裏。
文章示範的 code 可以在 GitHub repo 找到。
Intro
簡單的開場白，介紹將會提及的內容。 Architecture
Architecture Components (MVVM)、Modularization 和這次示範 app 所用的 architecture。 Endpoint
示範 app 會用到的 API endpoint 和 API response 對應的 data class。 Deserialization
比較 Gson、Moshi、Kotlin Serialization，並為上篇準備的 data class 加上 Kotlin Serialization 的 annotation。 Dependency injection
為 project 加入 Dagger Hilt。 HTTP Client
Ktor client 簡介、基本用法及把 Ktor client 加進 Dagger dependency graph。當中提及 @Inject、@InstallIn、@Singleton 及 @BindsOptionalOf 用法。 Data layer implementation (1)
車站及路綫 enum、domain layer repository interface、實作接駁 API endpoint、Dagger @Binds 用法及 Ktor client 跟 Retrofit 比較。 Data layer implementation (2)
API response data class 轉換到 domain layer data class 的 mapper。 Date & time
討論為甚麼要用 Java Time 而不是用 JDK 傳統的 Calendar、Date 的原因、為 project 加入 desugering library 及介紹 Time Zone Database。 Data layer testing (1)
JUnit 4 test、MockK 及 Strikt 基本用法。 Data layer testing (2)
用 Strikt 為 object 每個 property 做 assertion。 Data layer testing (3)
Ktor client 搭配 logback-android 在 unit test 時出現錯誤的解決方法、運用 Ktor mock engine 模擬 server response。 Data layer testing (4)
運用上篇的 Ktor mock engine 測試觸發 HTTP request 的 code 和經過 Kotlin Serialization deserialize 後的 response object 是否合符預期，另加 Strikt 自定義的 assertion。 Flipper
安裝 Flipper（只在 debug build type 才安裝）、Dagger Hilt 的 @HiltAndroidApp 及 @ApplicationContext 用法、Dagger @Qualifier 及 @BindsOptionalOf 用法、OkHttp client 加入 interceptor。 Domain layer implementation
實作 use case。 Domain layer testing
Use case 的 unit test。 Navigation (1)
安裝 Navigation component，準備將會用到的 Fragment 和 layout XML 檔案、簡單介紹 Dagger Hilt 的 @AndroidEntryPoint 及在 Fragment 使用 data binding 時要注意的地方。 Navigation (2)
定義 Navigation graph 並設定轉頁的參數、設定 MainActivity 以顯示 navigation graph 的頁面及使用轉頁參數時要注意的地方。 Station list screen (1)
實作車站列表頁介面，使用了 RecyclerView 的 ListAdapter、DiffUtil、data binding，並示範了 Dagger Hilt 的 @ActivityScoped 用法。 Station list screen (2)
實作車站列表頁的 ViewModel，示範了 Dagger Hilt 的 @HiltViewModel、Kotlin Flow 的 Channel、StateFlow/MutableStateFlow、combine、repeatOnLifecycle 用法和 Navigation component 防止用戶快速連按轉頁按鈕導致 crash 的方法。 ETA screen (1)
介紹抵站時間頁的流程，實作頁面基本的 layout XML、RecyclerView、ViewModel 及 onBackPressedDispatcher，另外亦示範了 Kotlin Sequence。 Whistle proxy
安裝 Whistle proxy、Whistle proxy 基本用法、在 Android 裝置安裝根證書、設定 network security configuration 及介紹 Proxy Toggle。 ETA screen (2)
SavedStateHandle 用法及以 Kotlin Flow 控制各式錯誤介面顯示。 ETA screen (3)
自動更新班次，介紹 Kotlin Coroutine 的 CoroutineScope、Job、delay 用法並使用 Java Time 的 Clock 取得當前時間。 ETA screen (4)
顯示錯誤 banner，介紹 Kotlin Coroutine 的 scan (runningFold) 用法，順帶講解 Kotlin Collection 的 fold 和 reduce。 Station list screen testing
安裝 Robolectric，為引用了 Android Context 的 class 寫 unit test；針對 Flipper 在 unit test 時報錯的解決方法；替換 Dispatchers.Main 及運用 Turbine 測試 Flow。 ETA screen testing (1)
示範 JUnit 4 parameterized test；介紹 cold flow (StateFlow) 跟 hot flow (SharedFlow) 的分別。 ETA screen testing (2)
運用 ThreeTen-Extra 提供的 MutableClock 及 Kotlin Coroutine 的 DelayController 改變時間並測試自動更新班次的邏輯。 Leftover topics
Two-way data binding、RecyclerView 局部更新、unidirectional data flow、instrumentation test 及 Coroutine dispatcher。 Wrapping up
參賽總結。 "><meta property="og:locale" content="zh-tw"><meta property="og:type" content="article"><meta property="article:published_time" content="2021-10-16T00:00:00+08:00"><meta property="article:modified_time" content="2021-10-16T00:00:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="2021 iThome 鐵人賽「寫一個列車抵站時間 Android App」文章目錄"><meta name=twitter:description content="以下是我參加 2021 iThome 鐵人賽 所寫的系列文章「寫一個列車抵站時間 Android App」的目錄。原文在 iThome 首次發表，在完賽後轉貼到這裏。
文章示範的 code 可以在 GitHub repo 找到。


Intro
簡單的開場白，介紹將會提及的內容。
Architecture
Architecture Components (MVVM)、Modularization 和這次示範 app 所用的 architecture。
Endpoint
示範 app 會用到的 API endpoint 和 API response 對應的 data class。
Deserialization
比較 Gson、Moshi、Kotlin Serialization，並為上篇準備的 data class 加上 Kotlin Serialization 的 annotation。
Dependency injection
為 project 加入 Dagger Hilt。
HTTP Client
Ktor client 簡介、基本用法及把 Ktor client 加進 Dagger dependency graph。當中提及 @Inject、@InstallIn、@Singleton 及 @BindsOptionalOf 用法。
Data layer implementation (1)
車站及路綫 enum、domain layer repository interface、實作接駁 API endpoint、Dagger @Binds 用法及 Ktor client 跟 Retrofit 比較。
Data layer implementation (2)
API response data class 轉換到 domain layer data class 的 mapper。
Date & time
討論為甚麼要用 Java Time 而不是用 JDK 傳統的 Calendar、Date 的原因、為 project 加入 desugering library 及介紹 Time Zone Database。
Data layer testing (1)
JUnit 4 test、MockK 及 Strikt 基本用法。
Data layer testing (2)
用 Strikt 為 object 每個 property 做 assertion。
Data layer testing (3)
Ktor client 搭配 logback-android 在 unit test 時出現錯誤的解決方法、運用 Ktor mock engine 模擬 server response。
Data layer testing (4)
運用上篇的 Ktor mock engine 測試觸發 HTTP request 的 code 和經過 Kotlin Serialization deserialize 後的 response object 是否合符預期，另加 Strikt 自定義的 assertion。
Flipper
安裝 Flipper（只在 debug build type 才安裝）、Dagger Hilt 的 @HiltAndroidApp 及 @ApplicationContext 用法、Dagger @Qualifier 及 @BindsOptionalOf 用法、OkHttp client 加入 interceptor。
Domain layer implementation
實作 use case。
Domain layer testing
Use case 的 unit test。
Navigation (1)
安裝 Navigation component，準備將會用到的 Fragment 和 layout XML 檔案、簡單介紹 Dagger Hilt 的 @AndroidEntryPoint 及在 Fragment 使用 data binding 時要注意的地方。
Navigation (2)
定義 Navigation graph 並設定轉頁的參數、設定 MainActivity 以顯示 navigation graph 的頁面及使用轉頁參數時要注意的地方。
Station list screen (1)
實作車站列表頁介面，使用了 RecyclerView 的 ListAdapter、DiffUtil、data binding，並示範了 Dagger Hilt 的 @ActivityScoped 用法。
Station list screen (2)
實作車站列表頁的 ViewModel，示範了 Dagger Hilt 的 @HiltViewModel、Kotlin Flow 的 Channel、StateFlow/MutableStateFlow、combine、repeatOnLifecycle 用法和 Navigation component 防止用戶快速連按轉頁按鈕導致 crash 的方法。
ETA screen (1)
介紹抵站時間頁的流程，實作頁面基本的 layout XML、RecyclerView、ViewModel 及 onBackPressedDispatcher，另外亦示範了 Kotlin Sequence。
Whistle proxy
安裝 Whistle proxy、Whistle proxy 基本用法、在 Android 裝置安裝根證書、設定 network security configuration 及介紹 Proxy Toggle。
ETA screen (2)
SavedStateHandle 用法及以 Kotlin Flow 控制各式錯誤介面顯示。
ETA screen (3)
自動更新班次，介紹 Kotlin Coroutine 的 CoroutineScope、Job、delay 用法並使用 Java Time 的 Clock 取得當前時間。
ETA screen (4)
顯示錯誤 banner，介紹 Kotlin Coroutine 的 scan (runningFold) 用法，順帶講解 Kotlin Collection 的 fold 和 reduce。
Station list screen testing
安裝 Robolectric，為引用了 Android Context 的 class 寫 unit test；針對 Flipper 在 unit test 時報錯的解決方法；替換 Dispatchers.Main 及運用 Turbine 測試 Flow。
ETA screen testing (1)
示範 JUnit 4 parameterized test；介紹 cold flow (StateFlow) 跟 hot flow (SharedFlow) 的分別。
ETA screen testing (2)
運用 ThreeTen-Extra 提供的 MutableClock 及 Kotlin Coroutine 的 DelayController 改變時間並測試自動更新班次的邏輯。
Leftover topics
Two-way data binding、RecyclerView 局部更新、unidirectional data flow、instrumentation test 及 Coroutine dispatcher。
Wrapping up
參賽總結。
"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"2021 iThome 鐵人賽「寫一個列車抵站時間 Android App」文章目錄","item":"https://eric.swiftzer.net/2021-ithome-ironman/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"2021 iThome 鐵人賽「寫一個列車抵站時間 Android App」文章目錄","name":"2021 iThome 鐵人賽「寫一個列車抵站時間 Android App」文章目錄","description":"以下是我參加 2021 iThome 鐵人賽 所寫的系列文章「寫一個列車抵站時間 Android App」的目錄。原文在 iThome 首次發表，在完賽後轉貼到這裏。\n文章示範的 code 可以在 GitHub repo 找到。\nIntro\n簡單的開場白，介紹將會提及的內容。 Architecture\nArchitecture Components (MVVM)、Modularization 和這次示範 app 所用的 architecture。 Endpoint\n示範 app 會用到的 API endpoint 和 API response 對應的 data class。 Deserialization\n比較 Gson、Moshi、Kotlin Serialization，並為上篇準備的 data class 加上 Kotlin Serialization 的 annotation。 Dependency injection\n為 project 加入 Dagger Hilt。 HTTP Client\nKtor client 簡介、基本用法及把 Ktor client 加進 Dagger dependency graph。當中提及 @Inject、@InstallIn、@Singleton 及 @BindsOptionalOf 用法。 Data layer implementation (1)\n車站及路綫 enum、domain layer repository interface、實作接駁 API endpoint、Dagger @Binds 用法及 Ktor client 跟 Retrofit 比較。 Data layer implementation (2)\nAPI response data class 轉換到 domain layer data class 的 mapper。 Date \u0026amp; time\n討論為甚麼要用 Java Time 而不是用 JDK 傳統的 Calendar、Date 的原因、為 project 加入 desugering library 及介紹 Time Zone Database。 Data layer testing (1)\nJUnit 4 test、MockK 及 Strikt 基本用法。 Data layer testing (2)\n用 Strikt 為 object 每個 property 做 assertion。 Data layer testing (3)\nKtor client 搭配 logback-android 在 unit test 時出現錯誤的解決方法、運用 Ktor mock engine 模擬 server response。 Data layer testing (4)\n運用上篇的 Ktor mock engine 測試觸發 HTTP request 的 code 和經過 Kotlin Serialization deserialize 後的 response object 是否合符預期，另加 Strikt 自定義的 assertion。 Flipper\n安裝 Flipper（只在 debug build type 才安裝）、Dagger Hilt 的 @HiltAndroidApp 及 @ApplicationContext 用法、Dagger @Qualifier 及 @BindsOptionalOf 用法、OkHttp client 加入 interceptor。 Domain layer implementation\n實作 use case。 Domain layer testing\nUse case 的 unit test。 Navigation (1)\n安裝 Navigation component，準備將會用到的 Fragment 和 layout XML 檔案、簡單介紹 Dagger Hilt 的 @AndroidEntryPoint 及在 Fragment 使用 data binding 時要注意的地方。 Navigation (2)\n定義 Navigation graph 並設定轉頁的參數、設定 MainActivity 以顯示 navigation graph 的頁面及使用轉頁參數時要注意的地方。 Station list screen (1)\n實作車站列表頁介面，使用了 RecyclerView 的 ListAdapter、DiffUtil、data binding，並示範了 Dagger Hilt 的 @ActivityScoped 用法。 Station list screen (2)\n實作車站列表頁的 ViewModel，示範了 Dagger Hilt 的 @HiltViewModel、Kotlin Flow 的 Channel、StateFlow/MutableStateFlow、combine、repeatOnLifecycle 用法和 Navigation component 防止用戶快速連按轉頁按鈕導致 crash 的方法。 ETA screen (1)\n介紹抵站時間頁的流程，實作頁面基本的 layout XML、RecyclerView、ViewModel 及 onBackPressedDispatcher，另外亦示範了 Kotlin Sequence。 Whistle proxy\n安裝 Whistle proxy、Whistle proxy 基本用法、在 Android 裝置安裝根證書、設定 network security configuration 及介紹 Proxy Toggle。 ETA screen (2)\nSavedStateHandle 用法及以 Kotlin Flow 控制各式錯誤介面顯示。 ETA screen (3)\n自動更新班次，介紹 Kotlin Coroutine 的 CoroutineScope、Job、delay 用法並使用 Java Time 的 Clock 取得當前時間。 ETA screen (4)\n顯示錯誤 banner，介紹 Kotlin Coroutine 的 scan (runningFold) 用法，順帶講解 Kotlin Collection 的 fold 和 reduce。 Station list screen testing\n安裝 Robolectric，為引用了 Android Context 的 class 寫 unit test；針對 Flipper 在 unit test 時報錯的解決方法；替換 Dispatchers.Main 及運用 Turbine 測試 Flow。 ETA screen testing (1)\n示範 JUnit 4 parameterized test；介紹 cold flow (StateFlow) 跟 hot flow (SharedFlow) 的分別。 ETA screen testing (2)\n運用 ThreeTen-Extra 提供的 MutableClock 及 Kotlin Coroutine 的 DelayController 改變時間並測試自動更新班次的邏輯。 Leftover topics\nTwo-way data binding、RecyclerView 局部更新、unidirectional data flow、instrumentation test 及 Coroutine dispatcher。 Wrapping up\n參賽總結。 ","keywords":[],"articleBody":"以下是我參加 2021 iThome 鐵人賽 所寫的系列文章「寫一個列車抵站時間 Android App」的目錄。原文在 iThome 首次發表，在完賽後轉貼到這裏。\n文章示範的 code 可以在 GitHub repo 找到。\nIntro\n簡單的開場白，介紹將會提及的內容。 Architecture\nArchitecture Components (MVVM)、Modularization 和這次示範 app 所用的 architecture。 Endpoint\n示範 app 會用到的 API endpoint 和 API response 對應的 data class。 Deserialization\n比較 Gson、Moshi、Kotlin Serialization，並為上篇準備的 data class 加上 Kotlin Serialization 的 annotation。 Dependency injection\n為 project 加入 Dagger Hilt。 HTTP Client\nKtor client 簡介、基本用法及把 Ktor client 加進 Dagger dependency graph。當中提及 @Inject、@InstallIn、@Singleton 及 @BindsOptionalOf 用法。 Data layer implementation (1)\n車站及路綫 enum、domain layer repository interface、實作接駁 API endpoint、Dagger @Binds 用法及 Ktor client 跟 Retrofit 比較。 Data layer implementation (2)\nAPI response data class 轉換到 domain layer data class 的 mapper。 Date \u0026 time\n討論為甚麼要用 Java Time 而不是用 JDK 傳統的 Calendar、Date 的原因、為 project 加入 desugering library 及介紹 Time Zone Database。 Data layer testing (1)\nJUnit 4 test、MockK 及 Strikt 基本用法。 Data layer testing (2)\n用 Strikt 為 object 每個 property 做 assertion。 Data layer testing (3)\nKtor client 搭配 logback-android 在 unit test 時出現錯誤的解決方法、運用 Ktor mock engine 模擬 server response。 Data layer testing (4)\n運用上篇的 Ktor mock engine 測試觸發 HTTP request 的 code 和經過 Kotlin Serialization deserialize 後的 response object 是否合符預期，另加 Strikt 自定義的 assertion。 Flipper\n安裝 Flipper（只在 debug build type 才安裝）、Dagger Hilt 的 @HiltAndroidApp 及 @ApplicationContext 用法、Dagger @Qualifier 及 @BindsOptionalOf 用法、OkHttp client 加入 interceptor。 Domain layer implementation\n實作 use case。 Domain layer testing\nUse case 的 unit test。 Navigation (1)\n安裝 Navigation component，準備將會用到的 Fragment 和 layout XML 檔案、簡單介紹 Dagger Hilt 的 @AndroidEntryPoint 及在 Fragment 使用 data binding 時要注意的地方。 Navigation (2)\n定義 Navigation graph 並設定轉頁的參數、設定 MainActivity 以顯示 navigation graph 的頁面及使用轉頁參數時要注意的地方。 Station list screen (1)\n實作車站列表頁介面，使用了 RecyclerView 的 ListAdapter、DiffUtil、data binding，並示範了 Dagger Hilt 的 @ActivityScoped 用法。 Station list screen (2)\n實作車站列表頁的 ViewModel，示範了 Dagger Hilt 的 @HiltViewModel、Kotlin Flow 的 Channel、StateFlow/MutableStateFlow、combine、repeatOnLifecycle 用法和 Navigation component 防止用戶快速連按轉頁按鈕導致 crash 的方法。 ETA screen (1)\n介紹抵站時間頁的流程，實作頁面基本的 layout XML、RecyclerView、ViewModel 及 onBackPressedDispatcher，另外亦示範了 Kotlin Sequence。 Whistle proxy\n安裝 Whistle proxy、Whistle proxy 基本用法、在 Android 裝置安裝根證書、設定 network security configuration 及介紹 Proxy Toggle。 ETA screen (2)\nSavedStateHandle 用法及以 Kotlin Flow 控制各式錯誤介面顯示。 ETA screen (3)\n自動更新班次，介紹 Kotlin Coroutine 的 CoroutineScope、Job、delay 用法並使用 Java Time 的 Clock 取得當前時間。 ETA screen (4)\n顯示錯誤 banner，介紹 Kotlin Coroutine 的 scan (runningFold) 用法，順帶講解 Kotlin Collection 的 fold 和 reduce。 Station list screen testing\n安裝 Robolectric，為引用了 Android Context 的 class 寫 unit test；針對 Flipper 在 unit test 時報錯的解決方法；替換 Dispatchers.Main 及運用 Turbine 測試 Flow。 ETA screen testing (1)\n示範 JUnit 4 parameterized test；介紹 cold flow (StateFlow) 跟 hot flow (SharedFlow) 的分別。 ETA screen testing (2)\n運用 ThreeTen-Extra 提供的 MutableClock 及 Kotlin Coroutine 的 DelayController 改變時間並測試自動更新班次的邏輯。 Leftover topics\nTwo-way data binding、RecyclerView 局部更新、unidirectional data flow、instrumentation test 及 Coroutine dispatcher。 Wrapping up\n參賽總結。 ","wordCount":"1417","inLanguage":"zh-tw","datePublished":"2021-10-16T00:00:00+08:00","dateModified":"2021-10-16T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://eric.swiftzer.net/2021-ithome-ironman/"},"publisher":{"@type":"Organization","name":"EricLog","logo":{"@type":"ImageObject","url":"https://eric.swiftzer.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://eric.swiftzer.net/ accesskey=h title="EricLog (Alt + H)">EricLog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://eric.swiftzer.net/fonts/ title=Fonts><span>Fonts</span></a></li><li><a href=https://eric.swiftzer.net/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://eric.swiftzer.net/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://eric.swiftzer.net/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://eric.swiftzer.net/>首頁</a></div><h1 class="post-title entry-hint-parent">2021 iThome 鐵人賽「寫一個列車抵站時間 Android App」文章目錄</h1><div class=post-meta><span title='2021-10-16 00:00:00 +0800 +0800'>October 16, 2021</span></div></header><div class=post-content><p>以下是我參加 <a href=https://ithelp.ithome.com.tw/2021ironman>2021 iThome 鐵人賽</a> 所寫的系列文章「<a href=https://ithelp.ithome.com.tw/users/20139666/ironman/4661>寫一個列車抵站時間 Android App</a>」的目錄。原文在 iThome 首次發表，在完賽後轉貼到這裏。</p><p>文章示範的 code 可以在 <a href=https://github.com/ericksli/eta-demo>GitHub repo</a> 找到。</p><hr><ol><li><a href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-01-intro/>Intro</a><br>簡單的開場白，介紹將會提及的內容。</li><li><a href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-02-architecture/>Architecture</a><br>Architecture Components (MVVM)、Modularization 和這次示範 app 所用的 architecture。</li><li><a href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-03-endpoint/>Endpoint</a><br>示範 app 會用到的 API endpoint 和 API response 對應的 data class。</li><li><a href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-04-deserialization/>Deserialization</a><br>比較 Gson、Moshi、Kotlin Serialization，並為上篇準備的 data class 加上 Kotlin Serialization 的 annotation。</li><li><a href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-05-dependency-injection/>Dependency injection</a><br>為 project 加入 Dagger Hilt。</li><li><a href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-06-http-client/>HTTP Client</a><br>Ktor client 簡介、基本用法及把 Ktor client 加進 Dagger dependency graph。當中提及 <code>@Inject</code>、<code>@InstallIn</code>、<code>@Singleton</code> 及 <code>@BindsOptionalOf</code> 用法。</li><li><a href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-07-data-layer-implementation-1/>Data layer implementation (1)</a><br>車站及路綫 enum、domain layer repository interface、實作接駁 API endpoint、Dagger <code>@Binds</code> 用法及 Ktor client 跟 Retrofit 比較。</li><li><a href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-08-data-layer-implementation-2/>Data layer implementation (2)</a><br>API response data class 轉換到 domain layer data class 的 mapper。</li><li><a href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-09-date-time/>Date & time</a><br>討論為甚麼要用 Java Time 而不是用 JDK 傳統的 <code>Calendar</code>、<code>Date</code> 的原因、為 project 加入 desugering library 及介紹 Time Zone Database。</li><li><a href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-10-data-layer-testing-1/>Data layer testing (1)</a><br>JUnit 4 test、MockK 及 Strikt 基本用法。</li><li><a href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-11-data-layer-testing-2/>Data layer testing (2)</a><br>用 Strikt 為 object 每個 property 做 assertion。</li><li><a href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-12-data-layer-testing-3/>Data layer testing (3)</a><br>Ktor client 搭配 logback-android 在 unit test 時出現錯誤的解決方法、運用 Ktor mock engine 模擬 server response。</li><li><a href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-13-data-layer-testing-4/>Data layer testing (4)</a><br>運用上篇的 Ktor mock engine 測試觸發 HTTP request 的 code 和經過 Kotlin Serialization deserialize 後的 response object 是否合符預期，另加 Strikt 自定義的 assertion。</li><li><a href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-14-flipper/>Flipper</a><br>安裝 Flipper（只在 debug build type 才安裝）、Dagger Hilt 的 <code>@HiltAndroidApp</code> 及 <code>@ApplicationContext</code> 用法、Dagger <code>@Qualifier</code> 及 <code>@BindsOptionalOf</code> 用法、OkHttp client 加入 interceptor。</li><li><a href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-15-domain-layer-implementation/>Domain layer implementation</a><br>實作 use case。</li><li><a href=https://eric.swiftzer.net/2021/10/2021-ithome-ironman-16-domain-layer-testing/>Domain layer testing</a><br>Use case 的 unit test。</li><li><a href=https://eric.swiftzer.net/2021/10/2021-ithome-ironman-17-navigation-1/>Navigation (1)</a><br>安裝 Navigation component，準備將會用到的 <code>Fragment</code> 和 layout XML 檔案、簡單介紹 Dagger Hilt 的 <code>@AndroidEntryPoint</code> 及在 <code>Fragment</code> 使用 data binding 時要注意的地方。</li><li><a href=https://eric.swiftzer.net/2021/10/2021-ithome-ironman-18-navigation-2/>Navigation (2)</a><br>定義 Navigation graph 並設定轉頁的參數、設定 <code>MainActivity</code> 以顯示 navigation graph 的頁面及使用轉頁參數時要注意的地方。</li><li><a href=https://eric.swiftzer.net/2021/10/2021-ithome-ironman-19-station-list-screen-1/>Station list screen (1)</a><br>實作車站列表頁介面，使用了 <code>RecyclerView</code> 的 <code>ListAdapter</code>、<code>DiffUtil</code>、data binding，並示範了 Dagger Hilt 的 <code>@ActivityScoped</code> 用法。</li><li><a href=https://eric.swiftzer.net/2021/10/2021-ithome-ironman-20-station-list-screen-2/>Station list screen (2)</a><br>實作車站列表頁的 <code>ViewModel</code>，示範了 Dagger Hilt 的 <code>@HiltViewModel</code>、Kotlin Flow 的 <code>Channel</code>、<code>StateFlow</code>/<code>MutableStateFlow</code>、<code>combine</code>、<code>repeatOnLifecycle</code> 用法和 Navigation component 防止用戶快速連按轉頁按鈕導致 crash 的方法。</li><li><a href=https://eric.swiftzer.net/2021/10/2021-ithome-ironman-21-eta-screen-1/>ETA screen (1)</a><br>介紹抵站時間頁的流程，實作頁面基本的 layout XML、<code>RecyclerView</code>、<code>ViewModel</code> 及 <code>onBackPressedDispatcher</code>，另外亦示範了 Kotlin <code>Sequence</code>。</li><li><a href=https://eric.swiftzer.net/2021/10/2021-ithome-ironman-22-whistle-proxy/>Whistle proxy</a><br>安裝 Whistle proxy、Whistle proxy 基本用法、在 Android 裝置安裝根證書、設定 network security configuration 及介紹 Proxy Toggle。</li><li><a href=https://eric.swiftzer.net/2021/10/2021-ithome-ironman-23-eta-screen-2/>ETA screen (2)</a><br><code>SavedStateHandle</code> 用法及以 Kotlin Flow 控制各式錯誤介面顯示。</li><li><a href=https://eric.swiftzer.net/2021/10/2021-ithome-ironman-24-eta-screen-3/>ETA screen (3)</a><br>自動更新班次，介紹 Kotlin Coroutine 的 <code>CoroutineScope</code>、<code>Job</code>、<code>delay</code> 用法並使用 Java Time 的 <code>Clock</code> 取得當前時間。</li><li><a href=https://eric.swiftzer.net/2021/10/2021-ithome-ironman-25-eta-screen-4/>ETA screen (4)</a><br>顯示錯誤 banner，介紹 Kotlin Coroutine 的 <code>scan</code> (<code>runningFold</code>) 用法，順帶講解 Kotlin Collection 的 <code>fold</code> 和 <code>reduce</code>。</li><li><a href=https://eric.swiftzer.net/2021/10/2021-ithome-ironman-26-station-list-screen-testing/>Station list screen testing</a><br>安裝 Robolectric，為引用了 Android <code>Context</code> 的 class 寫 unit test；針對 Flipper 在 unit test 時報錯的解決方法；替換 <code>Dispatchers.Main</code> 及運用 Turbine 測試 Flow。</li><li><a href=https://eric.swiftzer.net/2021/10/2021-ithome-ironman-27-eta-screen-testing-1/>ETA screen testing (1)</a><br>示範 JUnit 4 parameterized test；介紹 cold flow (<code>StateFlow</code>) 跟 hot flow (<code>SharedFlow</code>) 的分別。</li><li><a href=https://eric.swiftzer.net/2021/10/2021-ithome-ironman-28-eta-screen-testing-2/>ETA screen testing (2)</a><br>運用 ThreeTen-Extra 提供的 <code>MutableClock</code> 及 Kotlin Coroutine 的 <code>DelayController</code> 改變時間並測試自動更新班次的邏輯。</li><li><a href=https://eric.swiftzer.net/2021/10/2021-ithome-ironman-29-leftover-topics/>Leftover topics</a><br>Two-way data binding、<code>RecyclerView</code> 局部更新、unidirectional data flow、instrumentation test 及 Coroutine dispatcher。</li><li><a href=https://eric.swiftzer.net/2021/10/2021-ithome-ironman-30-wrapping-up/>Wrapping up</a><br>參賽總結。</li></ol></div><footer class=post-footer><ul class=post-tags></ul></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//efilm.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://eric.swiftzer.net/>EricLog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="複製";function s(){t.innerHTML="已複製！",setTimeout(()=>{t.innerHTML="複製"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>