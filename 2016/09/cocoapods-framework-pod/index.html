<!doctype html><html lang=zh-hant-hk dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>自己造一個 CocoaPods Framework Pod | EricLog</title><meta name=keywords content="iOS,tvOS,CocoaPods"><meta name=description content="最近工作需要將一個 tvOS app 的某些 class 抽出來變成能被 CocoaPods 安裝的私家 close source framework 讓其他人用。我都是第一次做 framework，在網上的教學主要都是教純 Xcode 的做法和使用 CocoaPods 下載 project dependency，詳細提及如何造一個 CocoaPods Pod 就比較少人寫。所以就寫出來跟大家分享。"><meta name=author content><link rel=canonical href=https://eric.swiftzer.net/2016/09/cocoapods-framework-pod/><link href=/assets/css/stylesheet.min.540e9d13c320add066cf1c3f0e0b529a475da4f4256e42083a40e3205f46886a.css integrity="sha256-VA6dE8MgrdBmzxw/DgtSmkddpPQlbkIIOkDjIF9GiGo=" rel="preload stylesheet" as=style><link rel=icon href=https://eric.swiftzer.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://eric.swiftzer.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://eric.swiftzer.net/favicon-32x32.png><link rel=apple-touch-icon href=https://eric.swiftzer.net/apple-touch-icon.png><link rel=mask-icon href=https://eric.swiftzer.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=JetBrains+Mono:wght@300&display=swap" rel=stylesheet><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1268728-8','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="自己造一個 CocoaPods Framework Pod"><meta property="og:description" content="最近工作需要將一個 tvOS app 的某些 class 抽出來變成能被 CocoaPods 安裝的私家 close source framework 讓其他人用。我都是第一次做 framework，在網上的教學主要都是教純 Xcode 的做法和使用 CocoaPods 下載 project dependency，詳細提及如何造一個 CocoaPods Pod 就比較少人寫。所以就寫出來跟大家分享。"><meta property="og:type" content="article"><meta property="og:url" content="https://eric.swiftzer.net/2016/09/cocoapods-framework-pod/"><meta property="article:published_time" content="2016-09-28T10:53:11+08:00"><meta property="article:modified_time" content="2016-09-28T10:53:11+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="自己造一個 CocoaPods Framework Pod"><meta name=twitter:description content="最近工作需要將一個 tvOS app 的某些 class 抽出來變成能被 CocoaPods 安裝的私家 close source framework 讓其他人用。我都是第一次做 framework，在網上的教學主要都是教純 Xcode 的做法和使用 CocoaPods 下載 project dependency，詳細提及如何造一個 CocoaPods Pod 就比較少人寫。所以就寫出來跟大家分享。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"自己造一個 CocoaPods Framework Pod","name":"自己造一個 CocoaPods Framework Pod","description":"最近工作需要將一個 tvOS app 的某些 class 抽出來變成能被 CocoaPods 安裝的私家 close source framework 讓其他人用。我都是第一次做 framework，在網上的教學主要都是教純 Xcode 的做法和使用 CocoaPods 下載 project dependency，詳細提及如何造一個 CocoaPods …","keywords":["iOS","tvOS","CocoaPods"],"articleBody":"最近工作需要將一個 tvOS app 的某些 class 抽出來變成能被 CocoaPods 安裝的私家 close source framework 讓其他人用。我都是第一次做 framework，在網上的教學主要都是教純 Xcode 的做法和使用 CocoaPods 下載 project dependency，詳細提及如何造一個 CocoaPods Pod 就比較少人寫。所以就寫出來跟大家分享。\nCocoaPods 是管理 Cocoa project 的 dependency manager。其他同類的還有 Carthage，但目前 CocoaPods 還是最多人用。假如我們想做一個叫 MyOwnPod 的私人 CocoaPods close source framework，要準備三個 Git repository：\n 用來存放 framework 源碼 (myownpod) 只讓內部組員存取 用來存放已 compile 的 CocoaPods Pod (myownpod-release) 讓用家存取 作為 Specs Repository (specs-repo) 讓用家存取，非必須  我就將步驟以這三個 repository 分成三部分寫。\nFramework 源碼 (myownpod) 要造一個 CocoaPods 的 pod（即是 dependency）並不需要開一個 Xcode framework project，只需要準備好 source code 和 podspec 檔案就可以了。因為 podspec 內會定義版本、source code 位置、public header file、要調用那些 framework 等等本來是在 Xcode framework project 定義的設定。如果你的 pod 需要依賴其他 pod 的話，也是定義在 podspec 內而不是用 podfile 來定義。\n一個 framework 通常都會有一個示範用的 Xcode project 來讓其他人知道 framework 的用法，而且在開發 framework 時還可以借它來測試一下。不過是 close source 的話這個示範 Xcode project 應該要另外做多一個放到其他地方。因為這個 repository 是不會讓其他人看到的。\n整個 repository 的檔案結構大概概會是這樣：\n. ├── Example │ ├── MyOwnPodExample │ │ ├── AppDelegate.h │ │ ├── AppDelegate.m │ │ ├── Assets.xcassets │ │ ├── Base.lproj │ │ ├── Info.plist │ │ ├── ViewController.h │ │ ├── ViewController.m │ │ └── main.m │ └── MyOwnPodExample.xcodeproj ├── LICENSE ├── Podfile ├── Podfile.lock ├── Pods ├── README.md ├── MyOwnPod │ ├── MyClassA.h │ ├── MyClassA.m │ ├── MyClassB.h │ ├── MyClassB.m │ ├── MyClassC.h │ ├── MyClassC.m │ ├── MyClassC.xib ├── MyOwnPod.podspec └── MyOwnPod.xcworkspace Example 目錄是用來放示範用的 Xcode project；而 MyOwnPod 目錄就是用來放 framework source code。如果按照 CocoaPods 的建議，這個目錄應該是要叫做 Pod。\n首先，將 framework source code 放在 MyOwnPod 目錄內，然後準備 podspec 檔。\n s.version 要用 semantic versioning。 s.platform 用了 :tvos 是因為這個 framework 是給 tvOS 用。如果是給 iOS 用的話就要寫成 :ios。 s.public_header_files 是用來標示那些 header file 可以被使用者看到，CocoaPods 會用它來生成 umbrella header。 這個 framework 需要用到 libxml2，所以多了 s.library 和 s.xcconfig，如果不需要用的話是不用加的。  Pod::Spec.new do |s| s.name = 'MyOwnPod' s.version = '0.1.0' s.summary = 'My own pod for demo.' s.description = This is just an example pod. DESC s.homepage = 'https://gitlab.com/ericksli/myownpod' # s.screenshots = 'www.example.com/screenshots_1', 'www.example.com/screenshots_2' s.license = { :type = 'proprietary', :file = 'LICENSE' } s.author = { 'Eric Li' = 'eric@swiftzer.net' } s.source = { :git = 'ssh://git@gitlab.com:ericksli/myownpod.git', :tag = s.version.to_s } s.social_media_url = 'https://twitter.com/ericksli' s.platform = :tvos, '9.0' s.source_files = 'MyOwnPod/**/*.{h,m}' s.resource_bundles = { 'MyOwnPod' = ['MyOwnPod/**/*.{storyboard,xib}'] } s.public_header_files = [ 'MyOwnPod/MyClassA.h', 'MyOwnPod/MyClassB.h' ] s.frameworks = 'UIKit', 'CoreGraphics' s.library = 'xml2' s.xcconfig = { 'HEADER_SEARCH_PATHS' = '$(SDKROOT)/usr/include/libxml2' } s.dependency 'Masonry' s.tvos.deployment_target = '9.0' s.requires_arc = true end 然後，用 Xcode 以平時的方法在 Example 目錄建立一個新 Xcode project。之後將 project 關閉並建立 Podfile。Podfile 就是要將 framework pod 加到示範 project 內。\nplatform :tvos, '9.0' use_frameworks! workspace 'MyOwnPod' target 'MyOwnPodExample' do project 'Example/MyOwnPodExample.xcodeproj' pod 'MyOwnPod', :path = '.' end 準備好 Podfile 後就可以用 pod install 安裝了，執行完之後會多了一個 MyOwnPod.xcworkspace 檔。以後就要用這個檔案來開啟示範 project。要修改 framework 的檔案可以在 Xcode 的 project navigator 中展開 Pods  Development Pods  MyOwnPod。內裹的檔案都是 symlink framework 的檔案。如果要增加或者刪除 framework 的檔案，需要再執行多次 pod install 或 pod update。\nCocoaPods Pod Repository (myownpod-release) 第二個要準備的 Git repository 就是用來放已 compile 的 framework。這個我們需要用 CocoaPods Packager 來替我們將 podspec 檔所定義的 pod build 成 framework。\npod package MyOwnPod.podspec --dynamic --force --verbose 執行完後，應該會生成到 framework 的目錄。我們可以用 lipo 檢查一下它支援的 architecture：\nlipo -info MyOwnPod.framework/MyOwnPod 以 tvOS 為例，framework 應該要有齊 x86_64 and arm64，這樣就能在 simulator 和實機上使用。但 CocoaPods Packager 目前只支援 iOS 和 macOS，如果要順利 build 到 tvOS framework 就要修改它的 source code。\n之後就可以準備 Git repository 的內容。將生成出來的內容抄到 Git repository 內，結構會是這樣：\n. ├── MyOwnPod.podspec └── tvos └── MyOwnPod.framework 這個 podspec 就是剛才 CocoaPods Packager 生成出來的，它會直接指向用 build 出來的 framework 而不是用 source code。Commit 後就要為這個 commit 加上版本號 tag。如果你的 s.version 是 0.1.0 的話，你就要 tag 它做 0.1.0。日後再出新版的話就將 repository 的檔案重新覆蓋，commit 完再為它加上新的 tag 然後 push 就可以了，只需要用 master branch，不用特別開其他 branch。CocoaPods 會用 tag 來找尋適當的版本。\nPush 完之後如果要用這個 framework 的話 Podfile 會直接使用 Git repository URL 和 tag 名：\nplatform :tvos, '9.0' use_frameworks! target 'MyOwnTVApp' do pod 'MyOwnPod', :git = 'git@gitlab.com:ericksli/myownpod-release.git', :tag = '0.1.0' end 私家 Specs Repository (specs-repo) 最後一個 Git repository 就是要做一個私家 specs repository，這部分不是必需的。Spec repository 就是用來集中存放不同 pod 的 podspec，如果你造了不少私家 pod 的話，可以考慮做一個 specs repository。這個 Git repository 和剛才的 pod repository 一樣，都是只用 master branch。但就不用加 tag。下面就是檔案結構：\n. └── Specs ├── MyOwnPod │ ├── 0.1.0 │ │ └── MyOwnPod.podspec │ └── 0.2.3 │ └── MyOwnPod.podspec └── AnotherPod └── 5.6.7 └── AnotherPod.podspec 這個 repository 所需要用到的 podspec 可以抄之前用 CocoaPods Packager 產生的 podspec，一個版本就有一個對應的目錄和 podspec。但要將 s.source 改成 CocoaPods pod repository 的 URL。\nPod::Spec.new do |s| s.name = 'MyOwnPod' s.version = '0.1.0' s.summary = 'My own pod for demo.' s.license = {\"type\"=\"proprietary\", \"file\"=\"LICENSE\"} s.authors = {\"Eric Li\"=\"eric@swiftzer.net\"} s.homepage = 'https://gitlab.com/ericksli/myownpod' s.description = 'This is just an example pod.' s.social_media_url = 'https://twitter.com/ericksli' s.frameworks = [\"UIKit\", \"CoreGraphics\"] s.libraries = 'xml2' s.requires_arc = true s.xcconfig = {\"HEADER_SEARCH_PATHS\"=\"$(SDKROOT)/usr/include/libxml2\"} s.source = { :git = 'ssh://git@gitlab.com:ericksli/myownpod-release.git', :tag = s.version.to_s } s.tvos.deployment_target = '9.0' s.tvos.vendored_framework = 'tvos/MyOwnPod.framework' end Push 完之後就可以使用這個 specs repository。在使用前，要先加入這個 repository（名稱沒有規定）：\npod repo add eric ssh://git@gitlab.com:ericksli/specs-repo.git 加入後，可以用 pod repo 檢查是否有官方（名稱是 master）和自己的 spec repository：\neric - Type: git (master) - URL: ssh://git@gitlab.com:ericksli/specs-repo.git - Path: /Users/eric/.cocoapods/repos/eric master - Type: git (master) - URL: https://github.com/CocoaPods/Specs.git - Path: /Users/eric/.cocoapods/repos/master 2 repos 要在 project 使用自己的 pod，Podfile 的寫法基本上和平時差不多。但要用 source 加入官方和自己的 spec repository 才可使用自己的 pod。\nsource 'https://github.com/CocoaPods/Specs.git' source 'ssh://git@gitlab.com:ericksli/specs-repo.git' platform :tvos, '9.0' use_frameworks! target 'MyOwnTVApp' do pod 'OtherThirdPartyPod' pod 'MyOwnPod', '~ 0.1.0' end 執行一次 pod install 就會下載剛才自製的 pod。\n補充  如果是做 open source pod 的話其實只需要做第一部分，然後直接交上去官方 repository 就完成。 其實 CocoaPods 有 pod lib create 指令來幫你起步，可以直接用它。 CocoaPods 建議用 Git repository 用 HTTPS 而非 SSH 連接，但私人使用的話其實也沒有甚麼問題。 CocoaPods Packager 在 build 的時候應該會同時 build 不同的 architecture（即是 universal framework），如果是 open source pod 的話就不用擔心 architecture 問題，因為用家可以自己控制用甚麼 architecture。 ","wordCount":"2341","inLanguage":"en","datePublished":"2016-09-28T10:53:11+08:00","dateModified":"2016-09-28T10:53:11+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://eric.swiftzer.net/2016/09/cocoapods-framework-pod/"},"publisher":{"@type":"Organization","name":"EricLog","logo":{"@type":"ImageObject","url":"https://eric.swiftzer.net/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://eric.swiftzer.net/ accesskey=h title="EricLog (Alt + H)">EricLog</a>
<span class=logo-switches><span class=theme-toggle title="(Alt + T)"><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://eric.swiftzer.net/fonts/ title=Fonts><span>Fonts</span></a></li><li><a href=https://eric.swiftzer.net/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://eric.swiftzer.net/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://eric.swiftzer.net/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>自己造一個 CocoaPods Framework Pod</h1><div class=post-meta>September 28, 2016</div></header><div class=post-content><p>最近工作需要將一個 tvOS app 的某些 class 抽出來變成能被 CocoaPods 安裝的私家 close source framework 讓其他人用。我都是第一次做 framework，在網上的教學主要都是教純 Xcode 的做法和使用 CocoaPods 下載 project dependency，詳細提及如何造一個 CocoaPods Pod 就比較少人寫。所以就寫出來跟大家分享。</p><p><a href=https://cocoapods.org/>CocoaPods</a> 是管理 Cocoa project 的 dependency manager。其他同類的還有 <a href=https://github.com/Carthage/Carthage>Carthage</a>，但目前 CocoaPods 還是最多人用。假如我們想做一個叫 <em>MyOwnPod</em> 的私人 CocoaPods close source framework，要準備三個 Git repository：</p><ol><li>用來存放 framework 源碼 (myownpod)
只讓內部組員存取</li><li>用來存放已 compile 的 CocoaPods Pod (myownpod-release)
讓用家存取</li><li>作為 Specs Repository (specs-repo)
讓用家存取，非必須</li></ol><p>我就將步驟以這三個 repository 分成三部分寫。</p><h2 id=framework-源碼--myownpod>Framework 源碼 (myownpod)<a hidden class=anchor aria-hidden=true href=#framework-源碼--myownpod>#</a></h2><p>要造一個 CocoaPods 的 pod（即是 dependency）並不需要開一個 Xcode framework project，只需要準備好 source code 和 podspec 檔案就可以了。因為 podspec 內會定義版本、source code 位置、public header file、要調用那些 framework 等等本來是在 Xcode framework project 定義的設定。如果你的 pod 需要依賴其他 pod 的話，也是定義在 podspec 內而不是用 podfile 來定義。</p><p>一個 framework 通常都會有一個示範用的 Xcode project 來讓其他人知道 framework 的用法，而且在開發 framework 時還可以借它來測試一下。不過是 close source 的話這個示範 Xcode project 應該要另外做多一個放到其他地方。因為這個 repository 是不會讓其他人看到的。</p><p>整個 repository 的檔案結構大概概會是這樣：</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>.
├── Example
│   ├── MyOwnPodExample
│   │   ├── AppDelegate.h
│   │   ├── AppDelegate.m
│   │   ├── Assets.xcassets
│   │   ├── Base.lproj
│   │   ├── Info.plist
│   │   ├── ViewController.h
│   │   ├── ViewController.m
│   │   └── main.m
│   └── MyOwnPodExample.xcodeproj
├── LICENSE
├── Podfile
├── Podfile.lock
├── Pods
├── README.md
├── MyOwnPod
│   ├── MyClassA.h
│   ├── MyClassA.m
│   ├── MyClassB.h
│   ├── MyClassB.m
│   ├── MyClassC.h
│   ├── MyClassC.m
│   ├── MyClassC.xib
├── MyOwnPod.podspec
└── MyOwnPod.xcworkspace
</code></pre></div><p><em>Example</em> 目錄是用來放示範用的 Xcode project；而 <em>MyOwnPod</em> 目錄就是用來放 framework source code。如果按照 <a href=https://guides.cocoapods.org/making/using-pod-lib-create.html>CocoaPods 的建議</a>，這個目錄應該是要叫做 <em>Pod</em>。</p><p>首先，將 framework source code 放在 <em>MyOwnPod</em> 目錄內，然後準備 podspec 檔。</p><ul><li><code>s.version</code> 要用 <a href=http://semver.org/>semantic versioning</a>。</li><li><code>s.platform</code> 用了 <code>:tvos</code> 是因為這個 framework 是給 tvOS 用。如果是給 iOS 用的話就要寫成 <code>:ios</code>。</li><li><code>s.public_header_files</code> 是用來標示那些 header file 可以被使用者看到，CocoaPods 會用它來生成 umbrella header。</li><li>這個 framework 需要用到 libxml2，所以多了 <code>s.library</code> 和 <code>s.xcconfig</code>，如果不需要用的話是不用加的。</li></ul><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=no>Pod</span><span class=o>::</span><span class=no>Spec</span><span class=o>.</span><span class=n>new</span> <span class=k>do</span> <span class=o>|</span><span class=n>s</span><span class=o>|</span>
  <span class=n>s</span><span class=o>.</span><span class=n>name</span>             <span class=o>=</span> <span class=s1>&#39;MyOwnPod&#39;</span>
  <span class=n>s</span><span class=o>.</span><span class=n>version</span>          <span class=o>=</span> <span class=s1>&#39;0.1.0&#39;</span>
  <span class=n>s</span><span class=o>.</span><span class=n>summary</span>          <span class=o>=</span> <span class=s1>&#39;My own pod for demo.&#39;</span>

  <span class=n>s</span><span class=o>.</span><span class=n>description</span>      <span class=o>=</span> <span class=s>&lt;&lt;-DESC
</span><span class=s></span><span class=no>This</span> <span class=n>is</span> <span class=n>just</span> <span class=n>an</span> <span class=n>example</span> <span class=n>pod</span><span class=o>.</span>
                       <span class=no>DESC</span>

  <span class=n>s</span><span class=o>.</span><span class=n>homepage</span>         <span class=o>=</span> <span class=s1>&#39;https://gitlab.com/ericksli/myownpod&#39;</span>
  <span class=c1># s.screenshots     = &#39;www.example.com/screenshots_1&#39;, &#39;www.example.com/screenshots_2&#39;</span>
  <span class=n>s</span><span class=o>.</span><span class=n>license</span>          <span class=o>=</span> <span class=p>{</span> <span class=ss>:type</span> <span class=o>=&gt;</span> <span class=s1>&#39;proprietary&#39;</span><span class=p>,</span> <span class=ss>:file</span> <span class=o>=&gt;</span> <span class=s1>&#39;LICENSE&#39;</span> <span class=p>}</span>
  <span class=n>s</span><span class=o>.</span><span class=n>author</span>           <span class=o>=</span> <span class=p>{</span> <span class=s1>&#39;Eric Li&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;eric@swiftzer.net&#39;</span> <span class=p>}</span>
  <span class=n>s</span><span class=o>.</span><span class=n>source</span>           <span class=o>=</span> <span class=p>{</span> <span class=ss>:git</span> <span class=o>=&gt;</span> <span class=s1>&#39;ssh://git@gitlab.com:ericksli/myownpod.git&#39;</span><span class=p>,</span> <span class=ss>:tag</span> <span class=o>=&gt;</span> <span class=n>s</span><span class=o>.</span><span class=n>version</span><span class=o>.</span><span class=n>to_s</span> <span class=p>}</span>
  <span class=n>s</span><span class=o>.</span><span class=n>social_media_url</span> <span class=o>=</span> <span class=s1>&#39;https://twitter.com/ericksli&#39;</span>

  <span class=n>s</span><span class=o>.</span><span class=n>platform</span> <span class=o>=</span> <span class=ss>:tvos</span><span class=p>,</span> <span class=s1>&#39;9.0&#39;</span>

  <span class=n>s</span><span class=o>.</span><span class=n>source_files</span> <span class=o>=</span> <span class=s1>&#39;MyOwnPod/**/*.{h,m}&#39;</span>
  
  <span class=n>s</span><span class=o>.</span><span class=n>resource_bundles</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s1>&#39;MyOwnPod&#39;</span> <span class=o>=&gt;</span> <span class=o>[</span><span class=s1>&#39;MyOwnPod/**/*.{storyboard,xib}&#39;</span><span class=o>]</span>
  <span class=p>}</span>

  <span class=n>s</span><span class=o>.</span><span class=n>public_header_files</span> <span class=o>=</span> <span class=o>[</span>
    <span class=s1>&#39;MyOwnPod/MyClassA.h&#39;</span><span class=p>,</span>
    <span class=s1>&#39;MyOwnPod/MyClassB.h&#39;</span>
  <span class=o>]</span>
  <span class=n>s</span><span class=o>.</span><span class=n>frameworks</span> <span class=o>=</span> <span class=s1>&#39;UIKit&#39;</span><span class=p>,</span> <span class=s1>&#39;CoreGraphics&#39;</span>
  <span class=n>s</span><span class=o>.</span><span class=n>library</span> <span class=o>=</span> <span class=s1>&#39;xml2&#39;</span>
  <span class=n>s</span><span class=o>.</span><span class=n>xcconfig</span> <span class=o>=</span> <span class=p>{</span> <span class=s1>&#39;HEADER_SEARCH_PATHS&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;$(SDKROOT)/usr/include/libxml2&#39;</span> <span class=p>}</span>
  <span class=n>s</span><span class=o>.</span><span class=n>dependency</span> <span class=s1>&#39;Masonry&#39;</span>
  <span class=n>s</span><span class=o>.</span><span class=n>tvos</span><span class=o>.</span><span class=n>deployment_target</span> <span class=o>=</span> <span class=s1>&#39;9.0&#39;</span>
  <span class=n>s</span><span class=o>.</span><span class=n>requires_arc</span> <span class=o>=</span> <span class=kp>true</span>
<span class=k>end</span></code></pre></div><p>然後，用 Xcode 以平時的方法在 <em>Example</em> 目錄建立一個新 Xcode project。之後將 project 關閉並建立 Podfile。Podfile 就是要將 framework pod 加到示範 project 內。</p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=n>platform</span> <span class=ss>:tvos</span><span class=p>,</span> <span class=s1>&#39;9.0&#39;</span>
<span class=n>use_frameworks!</span>

<span class=n>workspace</span> <span class=s1>&#39;MyOwnPod&#39;</span>

<span class=n>target</span> <span class=s1>&#39;MyOwnPodExample&#39;</span> <span class=k>do</span>
  <span class=n>project</span> <span class=s1>&#39;Example/MyOwnPodExample.xcodeproj&#39;</span>
  <span class=n>pod</span> <span class=s1>&#39;MyOwnPod&#39;</span><span class=p>,</span> <span class=ss>:path</span> <span class=o>=&gt;</span> <span class=s1>&#39;.&#39;</span>
<span class=k>end</span></code></pre></div><p>準備好 Podfile 後就可以用 <code>pod install</code> 安裝了，執行完之後會多了一個 MyOwnPod.xcworkspace 檔。以後就要用這個檔案來開啟示範 project。要修改 framework 的檔案可以在 Xcode 的 project navigator 中展開 Pods > Development Pods > MyOwnPod。內裹的檔案都是 symlink framework 的檔案。如果要增加或者刪除 framework 的檔案，需要再執行多次 <code>pod install</code> 或 <code>pod update</code>。</p><h2 id=cocoapods-pod-repository-myownpod-release>CocoaPods Pod Repository (myownpod-release)<a hidden class=anchor aria-hidden=true href=#cocoapods-pod-repository-myownpod-release>#</a></h2><p>第二個要準備的 Git repository 就是用來放已 compile 的 framework。這個我們需要用 <a href=https://github.com/CocoaPods/cocoapods-packager>CocoaPods Packager</a> 來替我們將 podspec 檔所定義的 pod build 成 framework。</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>pod package MyOwnPod.podspec --dynamic --force --verbose
</code></pre></div><p>執行完後，應該會生成到 framework 的目錄。我們可以用 <code>lipo</code> 檢查一下它支援的 architecture：</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>lipo -info MyOwnPod.framework/MyOwnPod
</code></pre></div><p>以 tvOS 為例，framework 應該要有齊 <code>x86_64</code> and <code>arm64</code>，這樣就能在 simulator 和實機上使用。但 CocoaPods Packager 目前只支援 iOS 和 macOS，如果要順利 build 到 tvOS framework 就要<a href=https://github.com/CocoaPods/cocoapods-packager/pull/161>修改它的 source code</a>。</p><p>之後就可以準備 Git repository 的內容。將生成出來的內容抄到 Git repository 內，結構會是這樣：</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>.
├── MyOwnPod.podspec
└── tvos
    └── MyOwnPod.framework
</code></pre></div><p>這個 podspec 就是剛才 CocoaPods Packager 生成出來的，它會直接指向用 build 出來的 framework 而不是用 source code。Commit 後就要為這個 commit 加上版本號 tag。如果你的 <code>s.version</code> 是 <code>0.1.0</code> 的話，你就要 tag 它做 <code>0.1.0</code>。日後再出新版的話就將 repository 的檔案重新覆蓋，commit 完再為它加上新的 tag 然後 push 就可以了，只需要用 master branch，不用特別開其他 branch。CocoaPods 會用 tag 來找尋適當的版本。</p><p>Push 完之後如果要用這個 framework 的話 Podfile 會直接使用 Git repository URL 和 tag 名：</p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=n>platform</span> <span class=ss>:tvos</span><span class=p>,</span> <span class=s1>&#39;9.0&#39;</span>
<span class=n>use_frameworks!</span>

<span class=n>target</span> <span class=s1>&#39;MyOwnTVApp&#39;</span> <span class=k>do</span>
    <span class=n>pod</span> <span class=s1>&#39;MyOwnPod&#39;</span><span class=p>,</span> <span class=ss>:git</span> <span class=o>=&gt;</span> <span class=s1>&#39;git@gitlab.com:ericksli/myownpod-release.git&#39;</span><span class=p>,</span> <span class=ss>:tag</span> <span class=o>=&gt;</span> <span class=s1>&#39;0.1.0&#39;</span>
<span class=k>end</span></code></pre></div><h2 id=私家-specs-repository-specs-repo>私家 Specs Repository (specs-repo)<a hidden class=anchor aria-hidden=true href=#私家-specs-repository-specs-repo>#</a></h2><p>最後一個 Git repository 就是要做一個私家 specs repository，這部分不是必需的。Spec repository 就是用來集中存放不同 pod 的 podspec，如果你造了不少私家 pod 的話，可以考慮做一個 specs repository。這個 Git repository 和剛才的 pod repository 一樣，都是只用 master branch。但就不用加 tag。下面就是檔案結構：</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>.
└── Specs
    ├── MyOwnPod
    │   ├── 0.1.0
    │   │   └── MyOwnPod.podspec
    │   └── 0.2.3
    │       └── MyOwnPod.podspec
    └── AnotherPod
        └── 5.6.7
            └── AnotherPod.podspec
</code></pre></div><p>這個 repository 所需要用到的 podspec 可以抄之前用 CocoaPods Packager 產生的 podspec，一個版本就有一個對應的目錄和 podspec。但要將 <code>s.source</code> 改成 CocoaPods pod repository 的 URL。</p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=no>Pod</span><span class=o>::</span><span class=no>Spec</span><span class=o>.</span><span class=n>new</span> <span class=k>do</span> <span class=o>|</span><span class=n>s</span><span class=o>|</span>
  <span class=n>s</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;MyOwnPod&#39;</span>
  <span class=n>s</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=s1>&#39;0.1.0&#39;</span>
  <span class=n>s</span><span class=o>.</span><span class=n>summary</span> <span class=o>=</span> <span class=s1>&#39;My own pod for demo.&#39;</span>
  <span class=n>s</span><span class=o>.</span><span class=n>license</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=o>=&gt;</span><span class=s2>&#34;proprietary&#34;</span><span class=p>,</span> <span class=s2>&#34;file&#34;</span><span class=o>=&gt;</span><span class=s2>&#34;LICENSE&#34;</span><span class=p>}</span>
  <span class=n>s</span><span class=o>.</span><span class=n>authors</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;Eric Li&#34;</span><span class=o>=&gt;</span><span class=s2>&#34;eric@swiftzer.net&#34;</span><span class=p>}</span>
  <span class=n>s</span><span class=o>.</span><span class=n>homepage</span> <span class=o>=</span> <span class=s1>&#39;https://gitlab.com/ericksli/myownpod&#39;</span>
  <span class=n>s</span><span class=o>.</span><span class=n>description</span> <span class=o>=</span> <span class=s1>&#39;This is just an example pod.&#39;</span>
  <span class=n>s</span><span class=o>.</span><span class=n>social_media_url</span> <span class=o>=</span> <span class=s1>&#39;https://twitter.com/ericksli&#39;</span>
  <span class=n>s</span><span class=o>.</span><span class=n>frameworks</span> <span class=o>=</span> <span class=o>[</span><span class=s2>&#34;UIKit&#34;</span><span class=p>,</span> <span class=s2>&#34;CoreGraphics&#34;</span><span class=o>]</span>
  <span class=n>s</span><span class=o>.</span><span class=n>libraries</span> <span class=o>=</span> <span class=s1>&#39;xml2&#39;</span>
  <span class=n>s</span><span class=o>.</span><span class=n>requires_arc</span> <span class=o>=</span> <span class=kp>true</span>
  <span class=n>s</span><span class=o>.</span><span class=n>xcconfig</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;HEADER_SEARCH_PATHS&#34;</span><span class=o>=&gt;</span><span class=s2>&#34;$(SDKROOT)/usr/include/libxml2&#34;</span><span class=p>}</span>
  <span class=n>s</span><span class=o>.</span><span class=n>source</span> <span class=o>=</span> <span class=p>{</span> <span class=ss>:git</span> <span class=o>=&gt;</span> <span class=s1>&#39;ssh://git@gitlab.com:ericksli/myownpod-release.git&#39;</span><span class=p>,</span> <span class=ss>:tag</span> <span class=o>=&gt;</span> <span class=n>s</span><span class=o>.</span><span class=n>version</span><span class=o>.</span><span class=n>to_s</span> <span class=p>}</span>

  <span class=n>s</span><span class=o>.</span><span class=n>tvos</span><span class=o>.</span><span class=n>deployment_target</span>    <span class=o>=</span> <span class=s1>&#39;9.0&#39;</span>
  <span class=n>s</span><span class=o>.</span><span class=n>tvos</span><span class=o>.</span><span class=n>vendored_framework</span>   <span class=o>=</span> <span class=s1>&#39;tvos/MyOwnPod.framework&#39;</span>
<span class=k>end</span></code></pre></div><p>Push 完之後就可以使用這個 specs repository。在使用前，要先加入這個 repository（名稱沒有規定）：</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>pod repo add eric ssh://git@gitlab.com:ericksli/specs-repo.git
</code></pre></div><p>加入後，可以用 <code>pod repo</code> 檢查是否有官方（名稱是 master）和自己的 spec repository：</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>eric
- Type: git (master)
- URL:  ssh://git@gitlab.com:ericksli/specs-repo.git
- Path: /Users/eric/.cocoapods/repos/eric

master
- Type: git (master)
- URL:  https://github.com/CocoaPods/Specs.git
- Path: /Users/eric/.cocoapods/repos/master

2 repos
</code></pre></div><p>要在 project 使用自己的 pod，Podfile 的寫法基本上和平時差不多。但要用 <code>source</code> 加入官方和自己的 spec repository 才可使用自己的 pod。</p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=n>source</span> <span class=s1>&#39;https://github.com/CocoaPods/Specs.git&#39;</span>
<span class=n>source</span> <span class=s1>&#39;ssh://git@gitlab.com:ericksli/specs-repo.git&#39;</span>

<span class=n>platform</span> <span class=ss>:tvos</span><span class=p>,</span> <span class=s1>&#39;9.0&#39;</span>
<span class=n>use_frameworks!</span>

<span class=n>target</span> <span class=s1>&#39;MyOwnTVApp&#39;</span> <span class=k>do</span>
    <span class=n>pod</span> <span class=s1>&#39;OtherThirdPartyPod&#39;</span>
    <span class=n>pod</span> <span class=s1>&#39;MyOwnPod&#39;</span><span class=p>,</span> <span class=s1>&#39;~&gt; 0.1.0&#39;</span>
<span class=k>end</span></code></pre></div><p>執行一次 <code>pod install</code> 就會下載剛才自製的 pod。</p><h2 id=補充>補充<a hidden class=anchor aria-hidden=true href=#補充>#</a></h2><ul><li>如果是做 open source pod 的話其實只需要做第一部分，然後直接交上去官方 repository 就完成。</li><li>其實 CocoaPods 有 <a href=https://guides.cocoapods.org/making/using-pod-lib-create.html><code>pod lib create</code></a> 指令來幫你起步，可以直接用它。</li><li>CocoaPods 建議用 Git repository 用 HTTPS 而非 SSH 連接，但私人使用的話其實也沒有甚麼問題。</li><li>CocoaPods Packager 在 build 的時候應該會同時 build 不同的 architecture（即是 universal framework），如果是 open source pod 的話就不用擔心 architecture 問題，因為用家可以自己控制用甚麼 architecture。</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://eric.swiftzer.net/tags/ios/>iOS</a></li><li><a href=https://eric.swiftzer.net/tags/tvos/>tvOS</a></li><li><a href=https://eric.swiftzer.net/tags/cocoapods/>CocoaPods</a></li></ul></footer><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"efilm"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2021 <a href=https://eric.swiftzer.net/>EricLog</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>