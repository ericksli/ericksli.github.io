<!doctype html><html lang=zh-hant-hk dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Notification Channel 自訂音效 | EricLog</title>
<meta name=keywords content="Android">
<meta name=description content="自從由 Android 8 開始，如果要顯示 notification 的話就一定要指定一個 notification channel，否則系統不會顯示。Notification channel 的目的是讓用戶能自行調節 app 的各">
<meta name=author content>
<link rel=canonical href=https://eric.swiftzer.net/2021/03/notification-channel-custom-sound/>
<link href=/assets/css/stylesheet.min.d1fc837a267f77f6ede89d1a89c4880a90c381d9e6673ad4a76a3ad1900b65f9.css integrity="sha256-0fyDeiZ/d/bt6J0aicSICpDDgdnmZzrUp2o60ZALZfk=" rel="preload stylesheet" as=style>
<link rel=icon href=https://eric.swiftzer.net/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://eric.swiftzer.net/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://eric.swiftzer.net/favicon-32x32.png>
<link rel=apple-touch-icon href=https://eric.swiftzer.net/apple-touch-icon.png>
<link rel=mask-icon href=https://eric.swiftzer.net/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<link rel=preconnect href=https://fonts.gstatic.com>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=JetBrains+Mono:wght@300&display=swap" rel=stylesheet>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-1268728-8','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<meta property="og:title" content="Notification Channel 自訂音效">
<meta property="og:description" content="自從由 Android 8 開始，如果要顯示 notification 的話就一定要指定一個 notification channel，否則系統不會顯示。Notification channel 的目的是讓用戶能自行調節 app 的各">
<meta property="og:type" content="article">
<meta property="og:url" content="https://eric.swiftzer.net/2021/03/notification-channel-custom-sound/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-03-13T22:10:00+08:00">
<meta property="article:modified_time" content="2021-03-13T22:10:00+08:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Notification Channel 自訂音效">
<meta name=twitter:description content="自從由 Android 8 開始，如果要顯示 notification 的話就一定要指定一個 notification channel，否則系統不會顯示。Notification channel 的目的是讓用戶能自行調節 app 的各">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://eric.swiftzer.net/posts/"},{"@type":"ListItem","position":2,"name":"Notification Channel 自訂音效","item":"https://eric.swiftzer.net/2021/03/notification-channel-custom-sound/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Notification Channel 自訂音效","name":"Notification Channel 自訂音效","description":"自從由 Android 8 開始，如果要顯示 notification 的話就一定要指定一個 notification channel，否則系統不會顯示。Notification channel 的目的是讓用戶能自行調節 app 的各","keywords":["Android"],"articleBody":"自從由 Android 8 開始，如果要顯示 notification 的話就一定要指定一個 notification channel，否則系統不會顯示。Notification channel 的目的是讓用戶能自行調節 app 的各式 notification 的提示方法，例如有沒有音效、會不會彈出 heads-up notification 之類。如果 app 想自訂 notification 的聲音亦都要經 notification channel 設定（但用戶可以之後自行變更 notification channel 的音效）\n但是要留意，設定自訂音效時那個 Uri 要用檔案名稱來設定，不要用 resource ID。以下是錯誤例子：\nval uri = Uri.Builder() .scheme(ContentResolver.SCHEME_ANDROID_RESOURCE) .authority(context.packageName) .appendPath(R.raw.example_notification.toString()) .build() 其實上面那個 Uri 是可以播放那個音效的。但問題是那個音效設定是儲存在系統而不是在自己的 app 入面。每次 build app 的時候不會保證那個 R.raw.example_notification 的 resource ID 是固定，如果在設定 notification channel 時用了 resource ID 的話日後 raw 資料夾的檔案有增減時就播了另一個檔案（因為現在的 build tool 是順着英文字母順序編排 resource ID，只要排序前面加插一個新的檔案就會播錯音效。）由於加插 raw 檔案導致播錯音效較難察覺，而且日後在 raw 加入新檔案的機會比把音效檔案重新命名的機會較大，所以在設定 notification channel 音效的 Uri 就應該用檔案名稱，就像下面那例子：\nfun createNotificationChannel(context: Context) { if (Build.VERSION.SDK_INT  Build.VERSION_CODES.O) return val channel = NotificationChannel( \"general\", context.getString(R.string.notification_channel_title_general), NotificationManager.IMPORTANCE_HIGH ).apply { description = context.getString(R.string.notification_channel_desc_general) val uri = Uri.Builder() .scheme(ContentResolver.SCHEME_ANDROID_RESOURCE) .authority(context.packageName) .appendPath(\"raw\") .appendPath(\"example_notification\") .build() val attributes = AudioAttributes.Builder() .setUsage(AudioAttributes.USAGE_NOTIFICATION) .build() setSound(uri, attributes) } val notificationManager = context.getSystemService(NotificationManager::class.java) notificationManager?.createNotificationChannel(channel) } 還有一點要留意：刪除 notification channel 後再重新建立相同 channel ID 的 notification channel 並不能重設用戶對 channel 的設定（包括 app 在建立 notification channel 時所定義的通知音效）。這是一個防止濫用的機制。如果那個 app 不斷彈出通知的話那用戶可以把那個 app 的 notification channel 重要性降低（例如不彈出通知），但如果 app 刪除 channel 再建立 channel 就能把那些用戶設定重設的話那 notification channel 功能就變得多餘。故此 Android notification channel 的用戶設定是有記憶的，重新建立相同 channel ID 的 notification channel 只會把之前的設定帶回來。設定頁更會顯示那個 app 刪除 notification channel 的次數來提醒用戶可能這個 app 可能有 spam。如果之前已經錯誤地用了 resource ID 來設定 notification channel 音效的話解決方法就只有改用另一個全新的 notification channel。\n參考  Android Notification Channel sounds stop working when using sound URIs that reference resource ids Categories deleted in notification settings  ","wordCount":"733","inLanguage":"en","datePublished":"2021-03-13T22:10:00+08:00","dateModified":"2021-03-13T22:10:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://eric.swiftzer.net/2021/03/notification-channel-custom-sound/"},"publisher":{"@type":"Organization","name":"EricLog","logo":{"@type":"ImageObject","url":"https://eric.swiftzer.net/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<noscript>
<style type=text/css>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://eric.swiftzer.net/ accesskey=h title="EricLog (Alt + H)">EricLog</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu onscroll=menu_on_scroll()>
<li>
<a href=https://eric.swiftzer.net/fonts/ title=Fonts>
<span>Fonts</span>
</a>
</li>
<li>
<a href=https://eric.swiftzer.net/archives/ title=Archives>
<span>Archives</span>
</a>
</li>
<li>
<a href=https://eric.swiftzer.net/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=https://eric.swiftzer.net/about/ title=About>
<span>About</span>
</a>
</li></ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs>
<a href=https://eric.swiftzer.net/>Home</a>&nbsp;»&nbsp;<a href=https://eric.swiftzer.net/posts/>Posts</a>
</div>
<h1 class=post-title>
Notification Channel 自訂音效
</h1>
<div class=post-meta>March 13, 2021
</div>
</header>
<div class=post-content>
<p>自從由 Android 8 開始，如果要顯示 <a href=https://developer.android.com/guide/topics/ui/notifiers/notifications>notification</a> 的話就一定要指定一個 <a href=https://developer.android.com/training/notify-user/channels>notification channel</a>，否則系統不會顯示。Notification channel 的目的是讓用戶能自行調節 app 的各式 notification 的提示方法，例如有沒有音效、會不會彈出 heads-up notification 之類。如果 app 想自訂 notification 的聲音亦都要經 notification channel 設定（但用戶可以之後自行變更 notification channel 的音效）</p>
<p>但是要留意，設定自訂音效時那個 <code>Uri</code> 要用檔案名稱來設定，不要用 resource ID。以下是錯誤例子：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=k>val</span> <span class=py>uri</span> <span class=p>=</span> <span class=n>Uri</span><span class=p>.</span><span class=n>Builder</span><span class=p>()</span>
    <span class=p>.</span><span class=n>scheme</span><span class=p>(</span><span class=n>ContentResolver</span><span class=p>.</span><span class=n>SCHEME_ANDROID_RESOURCE</span><span class=p>)</span>
    <span class=p>.</span><span class=n>authority</span><span class=p>(</span><span class=n>context</span><span class=p>.</span><span class=n>packageName</span><span class=p>)</span>
    <span class=p>.</span><span class=n>appendPath</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=n>raw</span><span class=p>.</span><span class=n>example_notification</span><span class=p>.</span><span class=n>toString</span><span class=p>())</span>
    <span class=p>.</span><span class=n>build</span><span class=p>()</span>
</code></pre></div><p>其實上面那個 <code>Uri</code> 是可以播放那個音效的。但問題是那個音效設定是儲存在系統而不是在自己的 app 入面。每次 build app 的時候不會保證那個 <code>R.raw.example_notification</code> 的 resource ID 是固定，如果在設定 notification channel 時用了 resource ID 的話日後 <em>raw</em> 資料夾的檔案有增減時就播了另一個檔案（因為現在的 build tool 是順着英文字母順序編排 resource ID，只要排序前面加插一個新的檔案就會播錯音效。）由於加插 <em>raw</em> 檔案導致播錯音效較難察覺，而且日後在 <em>raw</em> 加入新檔案的機會比把音效檔案重新命名的機會較大，所以在設定 notification channel 音效的 <code>Uri</code> 就應該用檔案名稱，就像下面那例子：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=k>fun</span> <span class=nf>createNotificationChannel</span><span class=p>(</span><span class=n>context</span><span class=p>:</span> <span class=n>Context</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>Build</span><span class=p>.</span><span class=n>VERSION</span><span class=p>.</span><span class=n>SDK_INT</span> <span class=p>&lt;</span> <span class=n>Build</span><span class=p>.</span><span class=n>VERSION_CODES</span><span class=p>.</span><span class=n>O</span><span class=p>)</span> <span class=k>return</span>

    <span class=k>val</span> <span class=py>channel</span> <span class=p>=</span> <span class=n>NotificationChannel</span><span class=p>(</span>
        <span class=s2>&#34;general&#34;</span><span class=p>,</span>
        <span class=n>context</span><span class=p>.</span><span class=n>getString</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=n>string</span><span class=p>.</span><span class=n>notification_channel_title_general</span><span class=p>),</span>
        <span class=n>NotificationManager</span><span class=p>.</span><span class=n>IMPORTANCE_HIGH</span>
    <span class=p>).</span><span class=n>apply</span> <span class=p>{</span>
        <span class=n>description</span> <span class=p>=</span> <span class=n>context</span><span class=p>.</span><span class=n>getString</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=n>string</span><span class=p>.</span><span class=n>notification_channel_desc_general</span><span class=p>)</span>
        <span class=k>val</span> <span class=py>uri</span> <span class=p>=</span> <span class=n>Uri</span><span class=p>.</span><span class=n>Builder</span><span class=p>()</span>
            <span class=p>.</span><span class=n>scheme</span><span class=p>(</span><span class=n>ContentResolver</span><span class=p>.</span><span class=n>SCHEME_ANDROID_RESOURCE</span><span class=p>)</span>
            <span class=p>.</span><span class=n>authority</span><span class=p>(</span><span class=n>context</span><span class=p>.</span><span class=n>packageName</span><span class=p>)</span>
            <span class=p>.</span><span class=n>appendPath</span><span class=p>(</span><span class=s2>&#34;raw&#34;</span><span class=p>)</span>
            <span class=p>.</span><span class=n>appendPath</span><span class=p>(</span><span class=s2>&#34;example_notification&#34;</span><span class=p>)</span>
            <span class=p>.</span><span class=n>build</span><span class=p>()</span>
        <span class=k>val</span> <span class=py>attributes</span> <span class=p>=</span> <span class=n>AudioAttributes</span><span class=p>.</span><span class=n>Builder</span><span class=p>()</span>
            <span class=p>.</span><span class=n>setUsage</span><span class=p>(</span><span class=n>AudioAttributes</span><span class=p>.</span><span class=n>USAGE_NOTIFICATION</span><span class=p>)</span>
            <span class=p>.</span><span class=n>build</span><span class=p>()</span>
        <span class=n>setSound</span><span class=p>(</span><span class=n>uri</span><span class=p>,</span> <span class=n>attributes</span><span class=p>)</span>
    <span class=p>}</span>

    <span class=k>val</span> <span class=py>notificationManager</span> <span class=p>=</span> <span class=n>context</span><span class=p>.</span><span class=n>getSystemService</span><span class=p>(</span><span class=n>NotificationManager</span><span class=o>::</span><span class=k>class</span><span class=p>.</span><span class=n>java</span><span class=p>)</span>
    <span class=n>notificationManager</span><span class=o>?.</span><span class=n>createNotificationChannel</span><span class=p>(</span><span class=n>channel</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><p>還有一點要留意：刪除 notification channel 後再重新建立相同 channel ID 的 notification channel 並不能重設用戶對 channel 的設定（包括 app 在建立 notification channel 時所定義的通知音效）。這是一個防止濫用的機制。如果那個 app 不斷彈出通知的話那用戶可以把那個 app 的 notification channel 重要性降低（例如不彈出通知），但如果 app 刪除 channel 再建立 channel 就能把那些用戶設定重設的話那 notification channel 功能就變得多餘。故此 Android notification channel 的用戶設定是有記憶的，重新建立相同 channel ID 的 notification channel 只會把之前的設定帶回來。設定頁更會顯示那個 app 刪除 notification channel 的次數來提醒用戶可能這個 app 可能有 spam。如果之前已經錯誤地用了 resource ID 來設定 notification channel 音效的話解決方法就只有改用另一個全新的 notification channel。</p>
<h2 id=參考>參考<a hidden class=anchor aria-hidden=true href=#參考>#</a></h2>
<ul>
<li><a href=https://stackoverflow.com/questions/54796492/android-notification-channel-sounds-stop-working-when-using-sound-uris-that-refe/54796493#54796493>Android Notification Channel sounds stop working when using sound URIs that reference resource ids</a></li>
<li><a href=https://us.community.samsung.com/t5/Galaxy-S-Phones/Categories-deleted-in-notification-settings/td-p/1277742>Categories deleted in notification settings</a></li>
</ul>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://eric.swiftzer.net/tags/android/>Android</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://eric.swiftzer.net/2021/03/android-sms-verification-apis/>
<span class=title>« Prev Page</span>
<br>
<span>Android SMS Verification APIs</span>
</a>
<a class=next href=https://eric.swiftzer.net/2020/11/androidx-datastore-with-kotlinx-serialization-protobuf/>
<span class=title>Next Page »</span>
<br>
<span>Jetpack DataStore 搭配 kotlinx.serialization Protobuf</span>
</a>
</nav>
</footer><div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//efilm.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</article>
</main><footer class=footer>
<span>&copy; 2021 <a href=https://eric.swiftzer.net/>EricLog</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)">
<button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</button>
</a>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>