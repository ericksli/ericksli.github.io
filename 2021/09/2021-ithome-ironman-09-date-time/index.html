<!doctype html><html lang=zh-tw dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>2021 iThome 鐵人賽 Day 9：Date & time | EricLog</title><meta name=keywords content="2021 iThome 鐵人賽,Android"><meta name=description content="本篇文章是 2021 iThome 鐵人賽參賽題目「寫一個列車抵站時間 Android App」的第 9 篇，你可到 iThome 查看原文。 文章目錄 上一篇在實作 EtaResponseMapper 的時候我們用了 Java 8 開始有的 Ins"><meta name=author content><link rel=canonical href=https://ithelp.ithome.com.tw/articles/10270899><link crossorigin=anonymous href=/assets/css/stylesheet.48ed1b8bd3873bc86534e1a6b0ba618b6c80d8a975cf0cf1f1835c2b89c5c5b0.css integrity="sha256-SO0bi9OHO8hlNOGmsLphi2yA2Kl1zwzx8YNcK4nFxbA=" rel="preload stylesheet" as=style><link rel=icon href=https://eric.swiftzer.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://eric.swiftzer.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://eric.swiftzer.net/favicon-32x32.png><link rel=apple-touch-icon href=https://eric.swiftzer.net/apple-touch-icon.png><link rel=mask-icon href=https://eric.swiftzer.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=JetBrains+Mono:wght@300&display=swap" rel=stylesheet><script async src="https://www.googletagmanager.com/gtag/js?id=G-D93F946T73"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-D93F946T73",{anonymize_ip:!1})}</script><meta property="og:title" content="2021 iThome 鐵人賽 Day 9：Date & time"><meta property="og:description" content="本篇文章是 2021 iThome 鐵人賽參賽題目「寫一個列車抵站時間 Android App」的第 9 篇，你可到 iThome 查看原文。 文章目錄 上一篇在實作 EtaResponseMapper 的時候我們用了 Java 8 開始有的 Ins"><meta property="og:type" content="article"><meta property="og:url" content="https://eric.swiftzer.net/2021/09/2021-ithome-ironman-09-date-time/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-09-24T00:00:00+08:00"><meta property="article:modified_time" content="2021-09-24T00:00:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="2021 iThome 鐵人賽 Day 9：Date & time"><meta name=twitter:description content="本篇文章是 2021 iThome 鐵人賽參賽題目「寫一個列車抵站時間 Android App」的第 9 篇，你可到 iThome 查看原文。 文章目錄 上一篇在實作 EtaResponseMapper 的時候我們用了 Java 8 開始有的 Ins"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://eric.swiftzer.net/posts/"},{"@type":"ListItem","position":2,"name":"2021 iThome 鐵人賽 Day 9：Date \u0026 time","item":"https://eric.swiftzer.net/2021/09/2021-ithome-ironman-09-date-time/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"2021 iThome 鐵人賽 Day 9：Date \u0026 time","name":"2021 iThome 鐵人賽 Day 9：Date \u0026 time","description":"本篇文章是 2021 iThome 鐵人賽參賽題目「寫一個列車抵站時間 Android App」的第 9 篇，你可到 iThome 查看原文。 文章目錄 上一篇在實作 EtaResponseMapper 的時候我們用了 Java 8 開始有的 Ins","keywords":["2021 iThome 鐵人賽","Android"],"articleBody":" 本篇文章是 2021 iThome 鐵人賽參賽題目「寫一個列車抵站時間 Android App」的第 9 篇，你可到 iThome 查看原文。\n文章目錄\n上一篇在實作 EtaResponseMapper 的時候我們用了 Java 8 開始有的 Instant、LocalDateTime 和 ZonedDateTime。它們都是跟日期時間相關的 class。但其實 Kotlin 都有 kotlinx-datetime 做類似的東西。但目前 kotlinx-datetime 還是在早期開發階段，有很多常用功能都未做到，例如我們這次需要用到的 formatter 目前仍需要用 Java time，所以還是用 Java time 算。\n在 Java 8 之前，Java Standard Library 是有 Calendar、Date 之類的 class，但它們本身的設計是古古怪怪。例如 Calendar 一月是用 0 表示，還有是沒有考慮到時區問題。所以後來就出現了 Joda Time 這個 library。受到 Joda Time 的啟發，之後就出了 JSR-310 的提案，最終就在 Java 8 的 Standard Library 加入了 Java Time。Java Time 除了之前用過的 DateTimeFormatter、LocalDateTime、ZonedDateTime 和 Instant 之外，還有其他常用的東西例如 Clock、Period、Duration 等等。它們都是用來表達不同的東西和方便我們計算關於日期時間的問題。例如我們會用 Instant 而不是一個 Long 的 variable 表示某個時刻、用 Duration 表示時段，這樣會令 code 更易理解，不用再擔心那個 Long 的單位是秒還是毫秒。另一個例子是計算 N 天後是幾年幾月幾日就不用再刻意把時分秒清零再加天數，因為可以用 LocalDate.now().plusDays(10) 就可以了。\n由於舊版 Android 並未支援 Java 8 的功能，所以我們需要靠 desugaring 來為我們的 app 補上部分 Java 8 或以上的 language feature，當中包括大部分的 Java Time 功能。加入 desugaring library 的方法很簡單，就是在 app module 的 build.gradle 加上以下的東西：\nandroid { // ... compileOptions { coreLibraryDesugaringEnabled true sourceCompatibility JavaVersion.VERSION_1_8 targetCompatibility JavaVersion.VERSION_1_8 } kotlinOptions { jvmTarget = '1.8' } } dependencies { coreLibraryDesugaring \"com.android.tools:desugar_jdk_libs:$desugaringVersion\" // ... } Desugaring 的原理其實就是把那些 Java 8 或以上能夠 backport 到的 language feature 在 compile 時幫你補上去 APK/AAB 內，所以不論 Android 版本是新還是舊都能行到那段 code，反正都是用你 APK/AAB 提供的 class 執行。\n加入了 desugaring 的 DEX 檔案包含了 Java Time 的 class 在未有 desugering 之前，一般都會用 ThreeTen Backport 代替 Java Time。\n時區問題 另一樣想借本篇討論的是時區的問題。在台灣或者香港都是 UTC+08:00，而且沒有日光節約時間 (daylight saving time, DST)。所以很多時在設計系統都沒有認真考慮時區問題（或者沒有意識到有這個問題），全部時間儲存都一概使用 UNIX timestamp。但如果系統日後需要支援多時區時就很難改得動了。\n首先我們要了解 Time Zone Database 和 time zone ID。Time Zone Database 是由 IANA 管理的時區資料庫（IANA 就是管理域名的那個機構），那個 database 就是要記錄世界各地以前至未來已知的時區資訊，當中包括日光節約時間的切換規則。\n那 time zone ID 就是我們平常寫 code 看到的 Asia/Hong_Kong、Asia/Taipei、Asia/Shanghai、 America/New_York 之類的東西。這些 ID 就是找一些有代表性的地名來命名，代表性的意思是指以時區、政府、以往實行過的時區之類有獨特性。雖然 Asia/Hong_Kong、Asia/Taipei、Asia/Shanghai 在現在都是指向 UTC+08:00，但為了能順利地轉換以前的日期時間仍要保留三個不同的 ID 表示。如果你有下載過 Time Zone Database 的話，用普通的純文字編輯器打開就會看到它會紀錄每個 time zone ID 何時選用那個 UTC 偏移量 (offset) 和有沒有執行夏令時間的資訊，還有更多的是有間該 time zone ID 的相關文獻。如果想了解更多那個地方時區的歷史的話 Time Zone Database 是不容錯過。\nTime Zone Database 香港部分 Time Zone Database 香港的部分\n其中一個有趣的東西是 Time Zone Database 跟中國大陸相關的有好幾個 ID，這是因為中國大陸曾經分被劃分為五個時區：\nAsia/Shanghai 上海 (UTC+08:00) Asia/Urumqi 烏魯木齊 (UTC+06:00) Asia/Harbin 哈爾濱，現在指向 Asia/Shanghai Asia/Chongqing 重慶，現在指向 Asia/Shanghai Asia/Kashgar 喀什，現在指向 Asia/Urumqi 這些重新指向的 ID 都是為了向後兼容，即是如果表達一個以前的當地時間我們仍可以配搭這些 ID 從而計算出 UNIX timestamp 或者反向計算出當地時間。\nWindows 10 UTC+08:00 時區 Windows 時區列表出現好幾個地名反映了以前那些地方都採用不同時區\n除了一般的時區問題之外，部分地方會實行日光節約時間 (Daylight Saving Time, DST)。意思是一年會切換兩次時區：大約在春季左右會找一天把時間調快一小時；在秋季又會再把時間調慢一小時還原。用意是因為夏天的日照時間長，把日常活動都調快一小時就能接觸更多陽光，從而節省能源（例如開少一小時電燈）。當然去到今時今日還能不能節省能源已成疑問，加上切換時間那兩天對工作和生活都造成影響。所以歐盟有考慮過廢除日光節約時間，但目前尚未實行。\n其實寫了那麼多 Time Zone Database 的東西都是想指出 UNIX timestamp 不能萬能，尤其是用於表達將來的時間。因為時區可以隨時因為各地政府的政策變更（例如會否在將來取消日光節約時間），所以如果要儲存幾年後的某月某日早上 9 時要開會的話，我們應該儲存當地時間及 time zone ID，不是 UNIX timestamp 或者當地時間及 UTC 偏移量。這樣即使政府改變時區都不會影響到儲存的資料（因為可以靠更新 Time Zone Database 以取得正確結果）。其中一個改變時區的例子是北韓，在 2015 年 8 月 15 日至 2018 年 5 月 4 日期間改用 UTC+08:30，其後改回跟南韓一樣 UTC+09:00。但如果是儲存過去的日期時間的話用 UNIX timestamp 就沒有大問題，因為過去的東西不會再改。\nTime Zone Database 更新 IANA 會跟據各地政府對時區的變更更新 Time Zone Database，所以一年可能會發布好幾個版本。這個 database 在不少地方用到，例如大家平常使用的作業系統、JRE 等等。它們都會透過系統更新或 JRE 版本更新來更新它們內裏所用的 Time Zone Database。有關 Android 系統更新 database 的方法可以參考 AOSP 網站。\n如果很在乎 Time Zone Database 是不是最新版的話，目前似乎只有 TickTock（不是抖音）和用回 ThreeTen Backport。\n另外，在使用 Java Time 的 method 前，緊記檢查 desugaring 支援的 class 和對 Java Time 的特別說明，因為 backport 始終有部分的實作仍依賴原系統的實作。\n參考 ThreeTen - Home page and Documentation JSR-310 的介紹網站，入面有對 JSR-310 主要 class 的解說（JSR-310 就是現在的 Java Time） Introduction to the Java 8 Date/Time API Introducing kotlinx-datetime by Ilya Gorbunov kotlinx-datetime 介紹，入面有講解各款 class 的用途，還有講解日光節約時間切換和為甚麼不能用 UNIX timestamp 表示將來發生的事件的問題。即使不是寫 Kotlin 都值得看 ","wordCount":"2337","inLanguage":"zh-tw","datePublished":"2021-09-24T00:00:00+08:00","dateModified":"2021-09-24T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://eric.swiftzer.net/2021/09/2021-ithome-ironman-09-date-time/"},"publisher":{"@type":"Organization","name":"EricLog","logo":{"@type":"ImageObject","url":"https://eric.swiftzer.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://eric.swiftzer.net/ accesskey=h title="EricLog (Alt + H)">EricLog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://eric.swiftzer.net/fonts/ title=Fonts><span>Fonts</span></a></li><li><a href=https://eric.swiftzer.net/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://eric.swiftzer.net/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://eric.swiftzer.net/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://eric.swiftzer.net/>首頁</a>&nbsp;»&nbsp;<a href=https://eric.swiftzer.net/posts/>Posts</a></div><h1 class=post-title>2021 iThome 鐵人賽 Day 9：Date & time</h1><div class=post-meta><span title='2021-09-24 00:00:00 +0800 +0800'>September 24, 2021</span></div></header><div class=post-content><blockquote><p>本篇文章是 <a href=https://ithelp.ithome.com.tw/2021ironman>2021 iThome 鐵人賽</a>參賽題目「<a href=https://ithelp.ithome.com.tw/users/20139666/ironman/4661>寫一個列車抵站時間 Android App</a>」的第 9 篇，你可到 iThome <a href=https://ithelp.ithome.com.tw/articles/10270899>查看原文</a>。</p><p><a href=https://eric.swiftzer.net/2021-ithome-ironman/>文章目錄</a></p></blockquote><p>上一篇在實作 <code>EtaResponseMapper</code> 的時候我們用了 Java 8 開始有的 <code>Instant</code>、<code>LocalDateTime</code> 和 <code>ZonedDateTime</code>。它們都是跟日期時間相關的 class。但其實 Kotlin 都有 <a href=https://github.com/Kotlin/kotlinx-datetime>kotlinx-datetime</a> 做類似的東西。但目前 kotlinx-datetime 還是在早期開發階段，有很多常用功能都未做到，例如我們這次需要用到的 formatter 目前仍需要用 Java time，所以還是用 Java time 算。</p><p>在 Java 8 之前，Java Standard Library 是有 <code>Calendar</code>、<code>Date</code> 之類的 class，但它們本身的設計是古古怪怪。例如 <code>Calendar</code> 一月是用 <code>0</code> 表示，還有是沒有考慮到時區問題。所以後來就出現了 <a href=https://www.joda.org/joda-time/>Joda Time</a> 這個 library。受到 Joda Time 的啟發，之後就出了 <a href="https://jcp.org/en/jsr/detail?id=310">JSR-310</a> 的提案，最終就在 Java 8 的 Standard Library 加入了 Java Time。Java Time 除了之前用過的 <code>DateTimeFormatter</code>、<code>LocalDateTime</code>、<code>ZonedDateTime</code> 和 <code>Instant</code> 之外，還有其他常用的東西例如 <code>Clock</code>、<code>Period</code>、<code>Duration</code> 等等。它們都是用來表達不同的東西和方便我們計算關於日期時間的問題。例如我們會用 <code>Instant</code> 而不是一個 <code>Long</code> 的 variable 表示某個時刻、用 <code>Duration</code> 表示時段，這樣會令 code 更易理解，不用再擔心那個 <code>Long</code> 的單位是秒還是毫秒。另一個例子是計算 N 天後是幾年幾月幾日就不用再刻意把時分秒清零再加天數，因為可以用 <code>LocalDate.now().plusDays(10)</code> 就可以了。</p><p>由於舊版 Android 並未支援 Java 8 的功能，所以我們需要靠 <a href=https://developer.android.com/studio/write/java8-support>desugaring</a> 來為我們的 app 補上部分 Java 8 或以上的 language feature，當中包括大部分的 Java Time 功能。加入 desugaring library 的方法很簡單，就是在 app module 的 <em>build.gradle</em> 加上以下的東西：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>android</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>compileOptions</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>coreLibraryDesugaringEnabled</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>        <span class=n>sourceCompatibility</span> <span class=n>JavaVersion</span><span class=o>.</span><span class=na>VERSION_1_8</span>
</span></span><span class=line><span class=cl>        <span class=n>targetCompatibility</span> <span class=n>JavaVersion</span><span class=o>.</span><span class=na>VERSION_1_8</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=n>kotlinOptions</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>jvmTarget</span> <span class=o>=</span> <span class=s1>&#39;1.8&#39;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dependencies</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>coreLibraryDesugaring</span> <span class=s2>&#34;com.android.tools:desugar_jdk_libs:$desugaringVersion&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></div><p>Desugaring 的原理其實就是把那些 Java 8 或以上能夠 backport 到的 language feature 在 compile 時幫你補上去 APK/AAB 內，所以不論 Android 版本是新還是舊都能行到那段 code，反正都是用你 APK/AAB 提供的 class 執行。</p><figure><img loading=lazy src=apk-content.png><figcaption>加入了 desugaring 的 DEX 檔案包含了 Java Time 的 class</figcaption></figure><p>在未有 desugering 之前，一般都會用 <a href=https://www.threeten.org/threetenbp/>ThreeTen Backport</a> 代替 Java Time。</p><h2 id=時區問題>時區問題<a hidden class=anchor aria-hidden=true href=#時區問題>#</a></h2><p>另一樣想借本篇討論的是時區的問題。在台灣或者香港都是 UTC+08:00，而且沒有日光節約時間 (daylight saving time, DST)。所以很多時在設計系統都沒有認真考慮時區問題（或者沒有意識到有這個問題），全部時間儲存都一概使用 UNIX timestamp。但如果系統日後需要支援多時區時就很難改得動了。</p><p>首先我們要了解 Time Zone Database 和 time zone ID。<a href=https://www.iana.org/time-zones>Time Zone Database</a> 是由 IANA 管理的時區資料庫（IANA 就是管理域名的那個機構），那個 database 就是要記錄世界各地以前至未來已知的時區資訊，當中包括日光節約時間的切換規則。</p><p>那 time zone ID 就是我們平常寫 code 看到的 <code>Asia/Hong_Kong</code>、<code>Asia/Taipei</code>、<code>Asia/Shanghai</code>、 <code>America/New_York</code> 之類的東西。這些 ID 就是找一些有代表性的地名來命名，代表性的意思是指以時區、政府、以往實行過的時區之類有獨特性。雖然 <code>Asia/Hong_Kong</code>、<code>Asia/Taipei</code>、<code>Asia/Shanghai</code> 在現在都是指向 UTC+08:00，但為了能順利地轉換以前的日期時間仍要保留三個不同的 ID 表示。如果你有下載過 Time Zone Database 的話，用普通的純文字編輯器打開就會看到它會紀錄每個 time zone ID 何時選用那個 UTC 偏移量 (offset) 和有沒有執行夏令時間的資訊，還有更多的是有間該 time zone ID 的相關文獻。如果想了解更多那個地方時區的歷史的話 Time Zone Database 是不容錯過。</p><figure><img loading=lazy src=tzdb.png><figcaption>Time Zone Database 香港部分</figcaption></figure><p>Time Zone Database 香港的部分</p><p>其中一個有趣的東西是 Time Zone Database 跟中國大陸相關的有好幾個 ID，這是因為<a href=https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%9C%8B%E6%99%82%E5%8D%80>中國大陸曾經分被劃分為五個時區</a>：</p><ul><li><code>Asia/Shanghai</code> 上海 (UTC+08:00)</li><li><code>Asia/Urumqi</code> 烏魯木齊 (UTC+06:00)</li><li><code>Asia/Harbin</code> 哈爾濱，現在指向 <code>Asia/Shanghai</code></li><li><code>Asia/Chongqing</code> 重慶，現在指向 <code>Asia/Shanghai</code></li><li><code>Asia/Kashgar</code> 喀什，現在指向 <code>Asia/Urumqi</code></li></ul><p>這些重新指向的 ID 都是為了向後兼容，即是如果表達一個以前的當地時間我們仍可以配搭這些 ID 從而計算出 UNIX timestamp 或者反向計算出當地時間。</p><figure><img loading=lazy src=windows-time-zone.png><figcaption>Windows 10 UTC+08:00 時區</figcaption></figure><p>Windows 時區列表出現好幾個地名反映了以前那些地方都採用不同時區</p><p>除了一般的時區問題之外，部分地方會實行日光節約時間 (Daylight Saving Time, DST)。意思是一年會切換兩次時區：大約在春季左右會找一天把時間調快一小時；在秋季又會再把時間調慢一小時還原。用意是因為夏天的日照時間長，把日常活動都調快一小時就能接觸更多陽光，從而節省能源（例如開少一小時電燈）。當然去到今時今日還能不能節省能源已成疑問，加上切換時間那兩天對工作和生活都造成影響。所以歐盟有考慮過廢除日光節約時間，但目前尚未實行。</p><p>其實寫了那麼多 Time Zone Database 的東西都是想指出 UNIX timestamp 不能萬能，尤其是用於表達將來的時間。因為時區可以隨時因為各地政府的政策變更（例如會否在將來取消日光節約時間），所以如果要儲存幾年後的某月某日早上 9 時要開會的話，我們應該儲存當地時間及 time zone ID，不是 UNIX timestamp 或者當地時間及 UTC 偏移量。這樣即使政府改變時區都不會影響到儲存的資料（因為可以靠更新 Time Zone Database 以取得正確結果）。其中一個改變時區的例子是北韓，<a href=https://www.storm.mg/article/431531>在 2015 年 8 月 15 日至 2018 年 5 月 4 日期間改用 UTC+08:30，其後改回跟南韓一樣 UTC+09:00</a>。但如果是儲存過去的日期時間的話用 UNIX timestamp 就沒有大問題，因為過去的東西不會再改。</p><h2 id=time-zone-database-更新>Time Zone Database 更新<a hidden class=anchor aria-hidden=true href=#time-zone-database-更新>#</a></h2><p>IANA 會跟據各地政府對時區的變更更新 Time Zone Database，所以一年可能會發布好幾個版本。這個 database 在不少地方用到，例如大家平常使用的作業系統、<a href=https://www.oracle.com/java/technologies/tzdata-versions.html>JRE</a> 等等。它們都會透過系統更新或 JRE 版本更新來更新它們內裏所用的 Time Zone Database。有關 Android 系統更新 database 的方法可以參考 <a href=https://source.android.com/devices/tech/config/timezone-rules>AOSP</a> 網站。</p><p>如果很在乎 Time Zone Database 是不是最新版的話，目前似乎只有 <a href=https://github.com/ZacSweers/ticktock>TickTock</a>（不是抖音）和用回 <a href=https://www.threeten.org/threetenbp/>ThreeTen Backport</a>。</p><p>另外，在使用 Java Time 的 method 前，緊記檢查 <a href=https://developer.android.com/studio/write/java8-support-table>desugaring 支援的 class 和對 Java Time 的特別說明</a>，因為 backport 始終有部分的實作仍依賴原系統的實作。</p><h2 id=參考>參考<a hidden class=anchor aria-hidden=true href=#參考>#</a></h2><ul><li><a href=https://www.threeten.org/>ThreeTen - Home page and Documentation</a> JSR-310 的介紹網站，入面有對 JSR-310 主要 class 的解說（JSR-310 就是現在的 Java Time）</li><li><a href=https://www.baeldung.com/java-8-date-time-intro>Introduction to the Java 8 Date/Time API</a></li><li><a href="https://www.youtube.com/watch?v=YwN0kAMNvXI">Introducing kotlinx-datetime by Ilya Gorbunov</a> kotlinx-datetime 介紹，入面有講解各款 class 的用途，還有講解日光節約時間切換和為甚麼不能用 UNIX timestamp 表示將來發生的事件的問題。即使不是寫 Kotlin 都值得看</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://eric.swiftzer.net/tags/2021-ithome-%E9%90%B5%E4%BA%BA%E8%B3%BD/>2021 iThome 鐵人賽</a></li><li><a href=https://eric.swiftzer.net/tags/android/>Android</a></li></ul><nav class=paginav><a class=prev href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-10-data-layer-testing-1/><span class=title>« 上一頁</span><br><span>2021 iThome 鐵人賽 Day 10：Data layer testing (1)</span></a>
<a class=next href=https://eric.swiftzer.net/2021/09/2021-ithome-ironman-08-data-layer-implementation-2/><span class=title>下一頁 »</span><br><span>2021 iThome 鐵人賽 Day 8：Data layer implementation (2)</span></a></nav></footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//efilm.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2024 <a href=https://eric.swiftzer.net/>EricLog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>