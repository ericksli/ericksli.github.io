<!doctype html><html lang=zh-hant-hk dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Java 量度單位 (JSR 363 Units of Measurement API) | EricLog</title><meta name=keywords content="Java,Android"><meta name=description content="在日常生活中，我們都會用到不同的量度單位。例如重量有時會用公斤 (kg)，有時會用磅 (lb)，有時又會用斤之類。如果在 Java 上表示這些數值，用 in"><meta name=author content><link rel=canonical href=http://eric.swiftzer.net/2020/08/javax-measure/><link href=/assets/css/stylesheet.min.540e9d13c320add066cf1c3f0e0b529a475da4f4256e42083a40e3205f46886a.css integrity="sha256-VA6dE8MgrdBmzxw/DgtSmkddpPQlbkIIOkDjIF9GiGo=" rel="preload stylesheet" as=style><link rel=icon href=http://eric.swiftzer.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://eric.swiftzer.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://eric.swiftzer.net/favicon-32x32.png><link rel=apple-touch-icon href=http://eric.swiftzer.net/apple-touch-icon.png><link rel=mask-icon href=http://eric.swiftzer.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=JetBrains+Mono:wght@300&display=swap" rel=stylesheet><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1268728-8','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="Java 量度單位 (JSR 363 Units of Measurement API)"><meta property="og:description" content="在日常生活中，我們都會用到不同的量度單位。例如重量有時會用公斤 (kg)，有時會用磅 (lb)，有時又會用斤之類。如果在 Java 上表示這些數值，用 in"><meta property="og:type" content="article"><meta property="og:url" content="http://eric.swiftzer.net/2020/08/javax-measure/"><meta property="article:published_time" content="2020-08-13T23:50:59+08:00"><meta property="article:modified_time" content="2020-08-13T23:50:59+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Java 量度單位 (JSR 363 Units of Measurement API)"><meta name=twitter:description content="在日常生活中，我們都會用到不同的量度單位。例如重量有時會用公斤 (kg)，有時會用磅 (lb)，有時又會用斤之類。如果在 Java 上表示這些數值，用 in"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Java 量度單位 (JSR 363 Units of Measurement API)","name":"Java 量度單位 (JSR 363 Units of Measurement API)","description":"在日常生活中，我們都會用到不同的量度單位。例如重量有時會用公斤 (kg)，有時會用磅 (lb)，有時又會用斤之類。如果在 Java 上表示這些數值，用 in","keywords":["Java","Android"],"articleBody":"在日常生活中，我們都會用到不同的量度單位。例如重量有時會用公斤 (kg)，有時會用磅 (lb)，有時又會用斤之類。如果在 Java 上表示這些數值，用 int、float、double 的話有時會令人理解錯誤，就好像 UNIX timestamp 般一時會用秒一時會用毫秒。為防止人們誤解這個 variable 或 method 的時間單位，通常都要在名稱加上 millis 之類的後綴。知名例子有 System.currentTimeMillis。如果處理時間的話，現成的有 TimeUnit。不過如果去到之前的重量單位的話，JDK 就沒有現成的 class。\n如果是 Android 的話可以用 android.icu.util.Measure，但要 API level 24 (Android 7.0) 或以上才可使用，而且不包括單位轉換功能。\n如果想在 Android API level 24 以前的裝置用到的話，可以考慮用 JSR 363 (Units of Measurement API)。它提供了一套 API 來表示量度單位和數值，而且包含單位轉換和格式化。\n如果要用這個 library 的話，是需要這兩個 artifact：\nimplementation \"tech.units:indriya:2.0.2\" implementation(\"systems.uom:systems-common:2.0.2\") { exclude group: 'jakarta.annotation', module: 'jakarta.annotation-api' } tech.units:indriya 是 JSR 363 的 reference implementation。它其實是用了 javax.measure:unit-api 所定義的 interface 的一個實作。而 systems.uom:systems-common 就提供了一些主流的單位的定義，例如 SI（國際單位制）、Imperial（英制）和 USCustomary（美制）。\n要去除 jakarta.annotation-api 是因為 Android Gradle plugin desugaring 時會加入和 jakarta.annotation 同名的 class，例如 javax.annotation.Generated。\n下面是一個由公里轉成哩的例子：\nimport org.junit.Assert.assertEquals import org.junit.Test import si.uom.SI import systems.uom.common.USCustomary import tech.units.indriya.quantity.Quantities import javax.measure.MetricPrefix import javax.measure.Quantity import javax.measure.quantity.Length class MeasureTest { @Test fun kilometerToMile() { val distanceKm: QuantityLength = Quantities.getQuantity(12, MetricPrefix.KILO(SI.METRE)) val distanceMile: QuantityLength = distanceKm.to(USCustomary.MILE) assertEquals(7.45645431, distanceMile.value.toDouble(), 0.00000001) } } 用了這個 library 就是要把數值包裝成 Quantity，然後就可以押後處理數值的實際單位，只需知道它是長度單位就可以了，直到需要輸出時才考慮單位的問題。如果需要為單位加上詞頭 (prefix) 的話，可以套上 MetricPrefix 的 KILO、CENTI、NANO 之類的 decorator。\n如果需要輸出顯示的話，可以用它提供的 NumberDelimiterQuantityFormat，不過我覺得不太好用，在 Android 的話可以用 string resource 處理。\n談到文章開首提及過的斤，systems.uom:systems-common 當然是沒有提供，但可以自己定義新的單位。根據香港法例第 68 章《度量衡條例》的定義，1 斤 = 0.60478982 公斤。我們可以用 si.uom.SI.KILOGRAM 做參照來衍生出斤這個單位：\nfun cattyToKilogram() { val catty = SI.KILOGRAM.multiply(60478982).divide(100000000) SimpleUnitFormat.getInstance().label(catty, \"斤\") val twoCatty = Quantities.getQuantity(2.0, catty) val kg = twoCatty.to(SI.KILOGRAM) assertEquals(1.209580, kg.value.toDouble(), 0.000001) } 值得一提，斤在不同地方有不同定義。中國的一斤是等於 0.5 公斤；台灣的一斤是等於 0.6 公斤。\n參考  Units of Measurement The First IoT JSR: Units of Measurement JSR-363 Introduction to javax.measure  ","wordCount":"995","inLanguage":"en","datePublished":"2020-08-13T23:50:59+08:00","dateModified":"2020-08-13T23:50:59+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://eric.swiftzer.net/2020/08/javax-measure/"},"publisher":{"@type":"Organization","name":"EricLog","logo":{"@type":"ImageObject","url":"http://eric.swiftzer.net/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=http://eric.swiftzer.net/ accesskey=h title="EricLog (Alt + H)">EricLog</a>
<span class=logo-switches><span class=theme-toggle title="(Alt + T)"><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=http://eric.swiftzer.net/fonts/ title=Fonts><span>Fonts</span></a></li><li><a href=http://eric.swiftzer.net/archives/ title=Archives><span>Archives</span></a></li><li><a href=http://eric.swiftzer.net/tags/ title=Tags><span>Tags</span></a></li><li><a href=http://eric.swiftzer.net/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Java 量度單位 (JSR 363 Units of Measurement API)</h1><div class=post-meta>August 13, 2020</div></header><div class=post-content><p>在日常生活中，我們都會用到不同的量度單位。例如重量有時會用公斤 (kg)，有時會用磅 (lb)，有時又會用斤之類。如果在 Java 上表示這些數值，用 <code>int</code>、<code>float</code>、<code>double</code> 的話有時會令人理解錯誤，就好像 UNIX timestamp 般一時會用秒一時會用毫秒。為防止人們誤解這個 variable 或 method 的時間單位，通常都要在名稱加上 <code>millis</code> 之類的後綴。知名例子有 <code>System.currentTimeMillis</code>。如果處理時間的話，現成的有 <a href=https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/TimeUnit.html><code>TimeUnit</code></a>。不過如果去到之前的重量單位的話，JDK 就沒有現成的 class。</p><p>如果是 Android 的話可以用 <a href=https://developer.android.com/reference/android/icu/util/Measure><code>android.icu.util.Measure</code></a>，但要 API level 24 (Android 7.0) 或以上才可使用，而且不包括單位轉換功能。</p><p>如果想在 Android API level 24 以前的裝置用到的話，可以考慮用 <a href=http://unitsofmeasurement.github.io/pages/about.html>JSR 363</a> (Units of Measurement API)。它提供了一套 API 來表示量度單位和數值，而且包含單位轉換和格式化。</p><p>如果要用這個 library 的話，是需要這兩個 artifact：</p><div class=highlight><pre class=chroma><code class=language-groovy data-lang=groovy><span class=n>implementation</span> <span class=s2>&#34;tech.units:indriya:2.0.2&#34;</span>
<span class=n>implementation</span><span class=o>(</span><span class=s2>&#34;systems.uom:systems-common:2.0.2&#34;</span><span class=o>)</span> <span class=o>{</span>
    <span class=n>exclude</span> <span class=nl>group:</span> <span class=s1>&#39;jakarta.annotation&#39;</span><span class=o>,</span> <span class=nl>module:</span> <span class=s1>&#39;jakarta.annotation-api&#39;</span>
<span class=o>}</span></code></pre></div><p><code>tech.units:indriya</code> 是 JSR 363 的 reference implementation。它其實是用了 <code>javax.measure:unit-api</code> 所定義的 interface 的一個實作。而 <code>systems.uom:systems-common</code> 就提供了一些主流的單位的定義，例如 <code>SI</code>（國際單位制）、<code>Imperial</code>（英制）和 <code>USCustomary</code>（美制）。</p><p>要去除 <code>jakarta.annotation-api</code> 是因為 Android Gradle plugin desugaring 時會加入和 <code>jakarta.annotation</code> 同名的 class，例如 <code>javax.annotation.Generated</code>。</p><p>下面是一個由公里轉成哩的例子：</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=k>import</span> <span class=nn>org.junit.Assert.assertEquals</span>
<span class=k>import</span> <span class=nn>org.junit.Test</span>
<span class=k>import</span> <span class=nn>si.uom.SI</span>
<span class=k>import</span> <span class=nn>systems.uom.common.USCustomary</span>
<span class=k>import</span> <span class=nn>tech.units.indriya.quantity.Quantities</span>
<span class=k>import</span> <span class=nn>javax.measure.MetricPrefix</span>
<span class=k>import</span> <span class=nn>javax.measure.Quantity</span>
<span class=k>import</span> <span class=nn>javax.measure.quantity.Length</span>

<span class=k>class</span> <span class=nc>MeasureTest</span> <span class=p>{</span>
    <span class=nd>@Test</span>
    <span class=k>fun</span> <span class=nf>kilometerToMile</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>val</span> <span class=py>distanceKm</span><span class=p>:</span> <span class=n>Quantity</span><span class=p>&lt;</span><span class=n>Length</span><span class=p>&gt;</span> <span class=p>=</span> <span class=n>Quantities</span><span class=p>.</span><span class=n>getQuantity</span><span class=p>(</span><span class=m>12</span><span class=p>,</span> <span class=n>MetricPrefix</span><span class=p>.</span><span class=n>KILO</span><span class=p>(</span><span class=n>SI</span><span class=p>.</span><span class=n>METRE</span><span class=p>))</span>
        <span class=k>val</span> <span class=py>distanceMile</span><span class=p>:</span> <span class=n>Quantity</span><span class=p>&lt;</span><span class=n>Length</span><span class=p>&gt;</span> <span class=p>=</span> <span class=n>distanceKm</span><span class=p>.</span><span class=n>to</span><span class=p>(</span><span class=n>USCustomary</span><span class=p>.</span><span class=n>MILE</span><span class=p>)</span>
        <span class=n>assertEquals</span><span class=p>(</span><span class=m>7.45645431</span><span class=p>,</span> <span class=n>distanceMile</span><span class=p>.</span><span class=n>value</span><span class=p>.</span><span class=n>toDouble</span><span class=p>(),</span> <span class=m>0.00000001</span><span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span></code></pre></div><p>用了這個 library 就是要把數值包裝成 <code>Quantity&lt;Length></code>，然後就可以押後處理數值的實際單位，只需知道它是長度單位就可以了，直到需要輸出時才考慮單位的問題。如果需要為單位加上<a href=https://zh.wikipedia.org/zh-hk/%E5%9B%BD%E9%99%85%E5%8D%95%E4%BD%8D%E5%88%B6%E8%AF%8D%E5%A4%B4>詞頭</a> (prefix) 的話，可以套上 <code>MetricPrefix</code> 的 <code>KILO</code>、<code>CENTI</code>、<code>NANO</code> 之類的 <a href=https://refactoring.guru/design-patterns/decorator>decorator</a>。</p><p>如果需要輸出顯示的話，可以用它提供的 <code>NumberDelimiterQuantityFormat</code>，不過我覺得不太好用，在 Android 的話可以用 string resource 處理。</p><p>談到文章開首提及過的斤，<code>systems.uom:systems-common</code> 當然是沒有提供，但可以自己定義新的單位。根據香港法例第 68 章<a href="https://www.elegislation.gov.hk/hk/cap68!en-zh-Hant-HK?INDEX_CS=N&xpid=ID_1438403555032_004">《度量衡條例》</a>的定義，1 斤 = 0.60478982 公斤。我們可以用 <code>si.uom.SI.KILOGRAM</code> 做參照來衍生出斤這個單位：</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=k>fun</span> <span class=nf>cattyToKilogram</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>val</span> <span class=py>catty</span> <span class=p>=</span> <span class=n>SI</span><span class=p>.</span><span class=n>KILOGRAM</span><span class=p>.</span><span class=n>multiply</span><span class=p>(</span><span class=m>60478982</span><span class=p>).</span><span class=n>divide</span><span class=p>(</span><span class=m>100000000</span><span class=p>)</span>
    <span class=n>SimpleUnitFormat</span><span class=p>.</span><span class=n>getInstance</span><span class=p>().</span><span class=n>label</span><span class=p>(</span><span class=n>catty</span><span class=p>,</span> <span class=s2>&#34;斤&#34;</span><span class=p>)</span>

    <span class=k>val</span> <span class=py>twoCatty</span> <span class=p>=</span> <span class=n>Quantities</span><span class=p>.</span><span class=n>getQuantity</span><span class=p>(</span><span class=m>2.0</span><span class=p>,</span> <span class=n>catty</span><span class=p>)</span>
    <span class=k>val</span> <span class=py>kg</span> <span class=p>=</span> <span class=n>twoCatty</span><span class=p>.</span><span class=n>to</span><span class=p>(</span><span class=n>SI</span><span class=p>.</span><span class=n>KILOGRAM</span><span class=p>)</span>
    <span class=n>assertEquals</span><span class=p>(</span><span class=m>1.209580</span><span class=p>,</span> <span class=n>kg</span><span class=p>.</span><span class=n>value</span><span class=p>.</span><span class=n>toDouble</span><span class=p>(),</span> <span class=m>0.000001</span><span class=p>)</span>
<span class=p>}</span></code></pre></div><p>值得一提，斤在不同地方有不同定義。中國的一斤是等於 0.5 公斤；台灣的一斤是等於 0.6 公斤。</p><h2 id=參考>參考<a hidden class=anchor aria-hidden=true href=#參考>#</a></h2><ul><li><a href=http://unitsofmeasurement.github.io/>Units of Measurement</a></li><li><a href=https://www.oracle.com/us/assets/lad-2015-ses16319-lima-compressed-2604608.pdf>The First IoT JSR: Units of Measurement JSR-363</a></li><li><a href=https://www.baeldung.com/javax-measure>Introduction to javax.measure</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=http://eric.swiftzer.net/tags/java/>Java</a></li><li><a href=http://eric.swiftzer.net/tags/android/>Android</a></li></ul></footer><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"efilm"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2021 <a href=http://eric.swiftzer.net/>EricLog</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>