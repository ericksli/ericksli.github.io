<!doctype html><html lang=zh-tw dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Jetpack Compose 遷移 (2) | EricLog</title>
<meta name=keywords content="Android"><meta name=description content="上一篇提過如何將 MetroRide 由傳統 view system 遷移到 Jetpack Compose。但一篇又太長，所以分拆成兩篇。 Dependency injection 按照官方的建議，composable function 要用到的 dependency 應該由"><meta name=author content><link rel=canonical href=https://eric.swiftzer.net/2022/07/jetpack-compose-migration-2/><link crossorigin=anonymous href=/assets/css/stylesheet.014d92f7e42768013bc6e6c6aaf7562cad235ef48b65d729ba2e6b2ceb3a58e1.css integrity="sha256-AU2S9+QnaAE7xubGqvdWLK0jXvSLZdcpui5rLOs6WOE=" rel="preload stylesheet" as=style><link rel=icon href=https://eric.swiftzer.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://eric.swiftzer.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://eric.swiftzer.net/favicon-32x32.png><link rel=apple-touch-icon href=https://eric.swiftzer.net/apple-touch-icon.png><link rel=mask-icon href=https://eric.swiftzer.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-tw href=https://eric.swiftzer.net/2022/07/jetpack-compose-migration-2/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=JetBrains+Mono:wght@300&display=swap" rel=stylesheet><script async src="https://www.googletagmanager.com/gtag/js?id=G-D93F946T73"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-D93F946T73",{anonymize_ip:!1})}</script><meta property="og:title" content="Jetpack Compose 遷移 (2)"><meta property="og:description" content="上一篇提過如何將 MetroRide 由傳統 view system 遷移到 Jetpack Compose。但一篇又太長，所以分拆成兩篇。 Dependency injection 按照官方的建議，composable function 要用到的 dependency 應該由"><meta property="og:type" content="article"><meta property="og:url" content="https://eric.swiftzer.net/2022/07/jetpack-compose-migration-2/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-26T14:00:00+08:00"><meta property="article:modified_time" content="2022-07-26T14:00:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Jetpack Compose 遷移 (2)"><meta name=twitter:description content="上一篇提過如何將 MetroRide 由傳統 view system 遷移到 Jetpack Compose。但一篇又太長，所以分拆成兩篇。 Dependency injection 按照官方的建議，composable function 要用到的 dependency 應該由"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://eric.swiftzer.net/posts/"},{"@type":"ListItem","position":2,"name":"Jetpack Compose 遷移 (2)","item":"https://eric.swiftzer.net/2022/07/jetpack-compose-migration-2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Jetpack Compose 遷移 (2)","name":"Jetpack Compose 遷移 (2)","description":"上一篇提過如何將 MetroRide 由傳統 view system 遷移到 Jetpack Compose。但一篇又太長，所以分拆成兩篇。 Dependency injection 按照官方的建議，composable function 要用到的 dependency 應該由","keywords":["Android"],"articleBody":"上一篇提過如何將 MetroRide 由傳統 view system 遷移到 Jetpack Compose。但一篇又太長，所以分拆成兩篇。\nDependency injection 按照官方的建議，composable function 要用到的 dependency 應該由 caller 經參數提供。然後就是由外層一直傳進去。至於那個外層最遠可以去到 Activity 或者 Fragment。由於 composable function 就是 top-level function，沒有 class 包住，所以平常用開的 Dagger 或者 Koin 之類的 DI library 都無辦法輕易地在 composable function 經 DI 拿到 dependency。如果以 Dagger Hilt 來計，目前是有這幾種方式：\n從 ViewModel 的 constructor injection 拿到 dependency，然後用 Hilt 的 viewModel 或 hiltViewModel function 在 composable function 拿到 ViewModel instance，再從 ViewModel 拿到 dependency 從 Activity 或者 Fragment 加 @Inject 做 field injection，然後帶進去 setContent lambda 為 dependency 準備 entry point，Context 可以經 LocalContext.current 拿到 其實三個方法我覺得都是很不 Compose。但很多時都可以避免到在 composable function 拿 dependency。例如在 ViewModel 外露已經計算好結果的 StateFlow，composable function 就會接到 data class 形式的 state，不需接觸到其他 dependency。這樣做 preview function 都容易處理。Android platform 的 dependency 例如 system service 可以用 LocalContext.current 拿到 Context 之後就拿到。我目前是按照官方建議 screen level 的 composable function 可以拿到 ViewModel，但內裏用到的 composable function 部件就不會再接觸到 ViewModel。但即使限制 composable function 接觸到 ViewModel 的機會，但始終會有部分 composable function 因為 parameter 有 ViewModel 而不能寫 preview function。日後我會試試把 ViewModel 限制在 Navigation component 的 composable/dialog lambda 內使用，所有 StateFlow 全部在 navigation 那邊轉成 Compose 的 State、ViewModel function call 變成 callback lambda。這樣就更容易為 screen level 的 composable function 寫 preview function。因為現在沒有 XML 版 Navigation component 這種的圖像化 navigation graph，如果連 screen level 的 composable function 都無預覽的話去到大 project 就很難維護。\n除了那三種方法外，如果是比較通用的東西可以用 CompositionLocal 而不用逐層傳入，例如剛才提及的 LocalContext。可以理解 CompositionLocal 就是 service locator。其實 Compose 的 Material Design theming 都用了 CompositionLocal 來減少傳遞參數。例子有 LocalContentAlpha 用來改變某個範圍的顏色透明度。我在這次遷移應該算是用得克制，只加了兩個自訂 CompositionLocal：一個是用來提供 Java 的 Clock，另一個是用來拿用戶語言設定（因為 app 有自己的語言設定，不是按系統設定），方便顯示文字內容。用法大致上是這樣：\n@Composable fun MetroRideAppContainer( viewModel: MainViewModel, splashScreenVisibleCondition: (SplashScreen.KeepOnScreenCondition) -\u003e Unit, quitApp: () -\u003e Unit, // 略…… ) { val appBlocking by viewModel.appBlocking.collectAsState() val uiLanguage by viewModel.uiLanguage.collectAsState() splashScreenVisibleCondition { appBlocking == AppBlocking.Checking } CompositionLocalProvider( LocalClock provides viewModel.clock, LocalUiLanguage provides uiLanguage, ) { val navController = rememberNavController() MetroRideTheme { AppNavHost( modifier = Modifier .fillMaxWidth() .weight(1f), navController = navController, ) } } } Interop MetroRide app 如果講跟傳統 view system 之間的 interop 的話就只有 AdMob 的 AdView 需要用到，Composable function 的 code 我已經放到 Gist。但 LeakCanary 有時會投訴 AdMob 的 WebView 會有 memory leak。暫時找不到解決方法。另外亦為 IDE preview 做了個專用 UI，方法是檢查 LocalInspectionMode 的 current。\nAdMob composable function preview 至於其他非傳統 view system 之間的 interop，其實 Google 之前都出了一堆 library 讓你在用 Compose 時減少直接接觸 Android platform 的功能。例如 Jetpack Lifecycle-aware components 將 Activity lifecycle 抽離、Activity Result APIs 取代 startActivityForResult、SavedStateHandle 取代 onSaveInstanceState 等等其實都會在 Compose 上用到。在 AdMob 那個 Gist 已經透過 LifecycleEventObserver 來得知當前的 lifecycle 狀態。\n主題 Jetpack Compose 有提供 Material Design 2 和 3 的 artifact。目前我仍使用 2，因為 3 還在 alpha，組件未夠齊（即使 Compose 版 Material Design 2 都是比傳統 view system 版少組件）。但講自訂程度我覺得 Compose 比傳統 view system 更好。傳統 view system 有 style resource 但要花時間查有那些地方可以用 style 改動，但 Compose 可以自己查 Material Design 組件的 composable function 源碼，發覺有地方不能自訂就把它的 code 抄走再改。而且 Compose 部分組件有提供原始版 composable function，例如負責文字輸入的 BasicTextField，它就是單純提供文字輸入功能。你喜歡加標題可以自己另外加個 Text、框線等等。但如果是傳統 view system 你要抄走某個 class 的 code 都不容易，因為要兼顧 Java/Kotlin code 的 access modifier 和 XML styleable attribute。\nMetroRide 的 UI 因為都是按照 Material Design 2 而造，所以沒有做太多自訂主題。最多都是按照 Material Design 2 做了 dialog（Compose 版 Material Design 2 做出來 dialog 跟 Material Design 網站講的式樣不同，所以我特別處理過）和搜尋欄。但在舊公司用 Compose 開發新功能時因為那個 app 的主題跟 Material Design 有出入所以試過自訂過 UI。大概是寫一個 composable function 包住 Compose 本身提供的組件 composable function，但已經把需要調整的參數都設定好，又或者是現有的組件被其他新組件包住。這個是 Compose 做自訂 UI 組件的方法：composition。\n小結 Compose 遷移就寫到這裏。其實遷移工作斷斷續續地做了半年。因為是 side-project 沒有時間限制，做了一部分又放下來做其他東西，再加上重鐵和輕鐵抵站時間在很久之前做了出來（重鐵那個在上去年參加 iThome 鐵人賽時拿來做示範 app，輕鐵是 MetroRide app 之前已經有的功能），隔了一段時間後都忘了之前的 code 寫了甚麼。其實還想分享一下 Navigation component，不過我覺得可以再開多一篇文。所以這部分會在下一篇出現。\n","wordCount":"1871","inLanguage":"zh-tw","datePublished":"2022-07-26T14:00:00+08:00","dateModified":"2022-07-26T14:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://eric.swiftzer.net/2022/07/jetpack-compose-migration-2/"},"publisher":{"@type":"Organization","name":"EricLog","logo":{"@type":"ImageObject","url":"https://eric.swiftzer.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://eric.swiftzer.net/ accesskey=h title="EricLog (Alt + H)">EricLog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://eric.swiftzer.net/fonts/ title=Fonts><span>Fonts</span></a></li><li><a href=https://eric.swiftzer.net/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://eric.swiftzer.net/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://eric.swiftzer.net/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://eric.swiftzer.net/>首頁</a>&nbsp;»&nbsp;<a href=https://eric.swiftzer.net/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Jetpack Compose 遷移 (2)</h1><div class=post-meta><span title='2022-07-26 14:00:00 +0800 +0800'>July 26, 2022</span></div></header><div class=post-content><p><a href=https://eric.swiftzer.net/2022/07/jetpack-compose-migration-1/>上一篇</a>提過如何將 <a href="https://play.google.com/store/apps/details?id=net.swiftzer.metroride">MetroRide</a> 由傳統 view system 遷移到 Jetpack Compose。但一篇又太長，所以分拆成兩篇。</p><h2 id=dependency-injection>Dependency injection<a hidden class=anchor aria-hidden=true href=#dependency-injection>#</a></h2><p>按照官方的建議，composable function 要用到的 dependency 應該由 caller 經參數提供。然後就是由外層一直傳進去。至於那個外層最遠可以去到 <code>Activity</code> 或者 <code>Fragment</code>。由於 composable function 就是 top-level function，沒有 class 包住，所以平常用開的 Dagger 或者 Koin 之類的 DI library 都無辦法輕易地在 composable function 經 DI 拿到 dependency。如果以 Dagger Hilt 來計，目前是有這幾種方式：</p><ol><li>從 <code>ViewModel</code> 的 constructor injection 拿到 dependency，然後用 Hilt 的 <code>viewModel</code> 或 <code>hiltViewModel</code> function 在 composable function 拿到 <code>ViewModel</code> instance，再從 <code>ViewModel</code> 拿到 dependency</li><li>從 <code>Activity</code> 或者 <code>Fragment</code> 加 <code>@Inject</code> 做 field injection，然後帶進去 <code>setContent</code> lambda</li><li>為 dependency 準備 <a href=https://dagger.dev/hilt/entry-points.html>entry point</a>，<code>Context</code> 可以經 <code>LocalContext.current</code> 拿到</li></ol><p>其實三個方法我覺得都是很不 Compose。但很多時都可以避免到在 composable function 拿 dependency。例如在 <code>ViewModel</code> 外露已經計算好結果的 <code>StateFlow</code>，composable function 就會接到 data class 形式的 state，不需接觸到其他 dependency。這樣做 preview function 都容易處理。Android platform 的 dependency 例如 system service 可以用 <code>LocalContext.current</code> 拿到 <code>Context</code> 之後就拿到。我目前是按照官方建議 screen level 的 composable function 可以拿到 <code>ViewModel</code>，但內裏用到的 composable function 部件就不會再接觸到 <code>ViewModel</code>。但即使限制 composable function 接觸到 <code>ViewModel</code> 的機會，但始終會有部分 composable function 因為 parameter 有 <code>ViewModel</code> 而不能寫 preview function。日後我會試試把 <code>ViewModel</code> 限制在 Navigation component 的 <code>composable</code>/<code>dialog</code> lambda 內使用，所有 <code>StateFlow</code> 全部在 navigation 那邊轉成 Compose 的 <code>State</code>、<code>ViewModel</code> function call 變成 callback lambda。這樣就更容易為 screen level 的 composable function 寫 preview function。因為現在沒有 XML 版 Navigation component 這種的圖像化 navigation graph，如果連 screen level 的 composable function 都無預覽的話去到大 project 就很難維護。</p><p>除了那三種方法外，如果是比較通用的東西可以用 <code>CompositionLocal</code> 而不用逐層傳入，例如剛才提及的 <code>LocalContext</code>。可以理解 <code>CompositionLocal</code> 就是 <a href=https://en.wikipedia.org/wiki/Service_locator_pattern>service locator</a>。其實 Compose 的 Material Design theming 都用了 <code>CompositionLocal</code> 來減少傳遞參數。例子有 <a href=https://developer.android.com/reference/kotlin/androidx/compose/material/package-summary#LocalContentAlpha()><code>LocalContentAlpha</code></a> 用來改變某個範圍的顏色透明度。我在這次遷移應該算是用得克制，只加了兩個自訂 <code>CompositionLocal</code>：一個是用來提供 Java 的 <a href=https://docs.oracle.com/javase/8/docs/api/java/time/Clock.html><code>Clock</code></a>，另一個是用來拿用戶語言設定（因為 app 有自己的語言設定，不是按系統設定），方便顯示文字內容。用法大致上是這樣：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>MetroRideAppContainer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>viewModel</span><span class=p>:</span> <span class=n>MainViewModel</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>splashScreenVisibleCondition</span><span class=p>:</span> <span class=p>(</span><span class=nc>SplashScreen</span><span class=p>.</span><span class=n>KeepOnScreenCondition</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Unit</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>quitApp</span><span class=p>:</span> <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Unit</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 略……
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>appBlocking</span> <span class=k>by</span> <span class=n>viewModel</span><span class=p>.</span><span class=n>appBlocking</span><span class=p>.</span><span class=n>collectAsState</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>uiLanguage</span> <span class=k>by</span> <span class=n>viewModel</span><span class=p>.</span><span class=n>uiLanguage</span><span class=p>.</span><span class=n>collectAsState</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>splashScreenVisibleCondition</span> <span class=p>{</span> <span class=n>appBlocking</span> <span class=o>==</span> <span class=nc>AppBlocking</span><span class=p>.</span><span class=n>Checking</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>CompositionLocalProvider</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>LocalClock</span> <span class=n>provides</span> <span class=n>viewModel</span><span class=p>.</span><span class=n>clock</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>LocalUiLanguage</span> <span class=n>provides</span> <span class=n>uiLanguage</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>navController</span> <span class=p>=</span> <span class=n>rememberNavController</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>MetroRideTheme</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>AppNavHost</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>modifier</span> <span class=p>=</span> <span class=n>Modifier</span>
</span></span><span class=line><span class=cl>                    <span class=p>.</span><span class=n>fillMaxWidth</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=p>.</span><span class=n>weight</span><span class=p>(</span><span class=m>1f</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>navController</span> <span class=p>=</span> <span class=n>navController</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=interop>Interop<a hidden class=anchor aria-hidden=true href=#interop>#</a></h2><p>MetroRide app 如果講跟傳統 view system 之間的 interop 的話就只有 AdMob 的 <code>AdView</code> 需要用到，<a href=https://gist.github.com/ericksli/d4e4ab21ddfcb0054bd8852f3b9ff31e>Composable function 的 code</a> 我已經放到 Gist。但 LeakCanary 有時會投訴 AdMob 的 <code>WebView</code> 會有 memory leak。暫時找不到解決方法。另外亦為 IDE preview 做了個專用 UI，方法是檢查 <code>LocalInspectionMode</code> 的 <code>current</code>。</p><figure><img loading=lazy src=adview-preview.png><figcaption>AdMob composable function preview</figcaption></figure><p>至於其他非傳統 view system 之間的 interop，其實 Google 之前都出了一堆 library 讓你在用 Compose 時減少直接接觸 Android platform 的功能。例如 Jetpack Lifecycle-aware components 將 <code>Activity</code> lifecycle 抽離、Activity Result APIs 取代 <code>startActivityForResult</code>、<code>SavedStateHandle</code> 取代 <code>onSaveInstanceState</code> 等等其實都會在 Compose 上用到。在 AdMob 那個 Gist 已經透過 <code>LifecycleEventObserver</code> 來得知當前的 lifecycle 狀態。</p><h2 id=主題>主題<a hidden class=anchor aria-hidden=true href=#主題>#</a></h2><p>Jetpack Compose 有提供 <a href=https://material.io/design/introduction>Material Design</a> 2 和 3 的 artifact。目前我仍使用 2，因為 3 還在 alpha，組件未夠齊（即使 Compose 版 Material Design 2 都是比傳統 view system 版少組件）。但講自訂程度我覺得 Compose 比傳統 view system 更好。傳統 view system 有 style resource 但要花時間查有那些地方可以用 style 改動，但 Compose 可以自己查 Material Design 組件的 composable function 源碼，發覺有地方不能自訂就把它的 code 抄走再改。而且 Compose 部分組件有提供原始版 composable function，例如負責文字輸入的 <a href=https://developer.android.com/reference/kotlin/androidx/compose/foundation/text/package-summary#BasicTextField(kotlin.String,kotlin.Function1,androidx.compose.ui.Modifier,kotlin.Boolean,kotlin.Boolean,androidx.compose.ui.text.TextStyle,androidx.compose.foundation.text.KeyboardOptions,androidx.compose.foundation.text.KeyboardActions,kotlin.Boolean,kotlin.Int,androidx.compose.ui.text.input.VisualTransformation,kotlin.Function1,androidx.compose.foundation.interaction.MutableInteractionSource,androidx.compose.ui.graphics.Brush,kotlin.Function1)><code>BasicTextField</code></a>，它就是單純提供文字輸入功能。你喜歡加標題可以自己另外加個 <code>Text</code>、框線等等。但如果是傳統 view system 你要抄走某個 class 的 code 都不容易，因為要兼顧 Java/Kotlin code 的 access modifier 和 XML styleable attribute。</p><p>MetroRide 的 UI 因為都是按照 Material Design 2 而造，所以沒有做太多自訂主題。最多都是按照 Material Design 2 做了 dialog（Compose 版 Material Design 2 做出來 dialog 跟 Material Design 網站講的式樣不同，所以我特別處理過）和搜尋欄。但在舊公司用 Compose 開發新功能時因為那個 app 的主題跟 Material Design 有出入所以試過自訂過 UI。大概是寫一個 composable function 包住 Compose 本身提供的組件 composable function，但已經把需要調整的參數都設定好，又或者是現有的組件被其他新組件包住。這個是 Compose 做自訂 UI 組件的方法：composition。</p><h2 id=小結>小結<a hidden class=anchor aria-hidden=true href=#小結>#</a></h2><p>Compose 遷移就寫到這裏。其實遷移工作斷斷續續地做了半年。因為是 side-project 沒有時間限制，做了一部分又放下來做其他東西，再加上重鐵和輕鐵抵站時間在很久之前做了出來（重鐵那個在上去年參加 <a href=https://eric.swiftzer.net/2021-ithome-ironman/>iThome 鐵人賽</a>時拿來做示範 app，輕鐵是 MetroRide app 之前已經有的功能），隔了一段時間後都忘了之前的 code 寫了甚麼。其實還想分享一下 Navigation component，不過我覺得可以再開多一篇文。所以這部分會在下一篇出現。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://eric.swiftzer.net/tags/android/>Android</a></li></ul><nav class=paginav><a class=prev href=https://eric.swiftzer.net/2022/07/jetpack-compose-navigation-component-sub-graph/><span class=title>« 上一頁</span><br><span>Jetpack Compose Navigation component sub-graph</span>
</a><a class=next href=https://eric.swiftzer.net/2022/07/jetpack-compose-migration-1/><span class=title>下一頁 »</span><br><span>Jetpack Compose 遷移 (1)</span></a></nav></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//efilm.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2024 <a href=https://eric.swiftzer.net/>EricLog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>