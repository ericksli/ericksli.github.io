<!doctype html><html lang=zh-tw dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Jetpack Compose Navigation component sub-graph | EricLog</title>
<meta name=keywords content="Android,Jetpack Compose"><meta name=description content="這次遷移到 Compose 時特別花了時間試用 Compose 的 Navigation component，終於弄清 nested graph 的意義。其實 Compose 的 Navigation component 底層都是跟 XML 版的 Navigation component 一樣，只是底層多了以 route 形式的處理。以往的說明文件在介紹 nested navigation graph 時沒有太具體說明 nested graph 背後的意義，看完之後可能覺得只是用來避免單一 XML 檔過長而拆成不同 sub-graph。但其實在 deep link 時是有特別意義。"><meta name=author content><link rel=canonical href=https://eric.swiftzer.net/2022/07/jetpack-compose-navigation-component-sub-graph/><link crossorigin=anonymous href=/assets/css/stylesheet.90d199bcefc47701be1700bdf90111f08c9ec8cafb7121eac1388d2f16c2cb69.css integrity="sha256-kNGZvO/EdwG+FwC9+QER8IyeyMr7cSHqwTiNLxbCy2k=" rel="preload stylesheet" as=style><link rel=icon href=https://eric.swiftzer.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://eric.swiftzer.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://eric.swiftzer.net/favicon-32x32.png><link rel=apple-touch-icon href=https://eric.swiftzer.net/apple-touch-icon.png><link rel=mask-icon href=https://eric.swiftzer.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-tw href=https://eric.swiftzer.net/2022/07/jetpack-compose-navigation-component-sub-graph/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=JetBrains+Mono:wght@300&display=swap" rel=stylesheet><script async src="https://www.googletagmanager.com/gtag/js?id=G-D93F946T73"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-D93F946T73")}</script><meta property="og:url" content="https://eric.swiftzer.net/2022/07/jetpack-compose-navigation-component-sub-graph/"><meta property="og:site_name" content="EricLog"><meta property="og:title" content="Jetpack Compose Navigation component sub-graph"><meta property="og:description" content="這次遷移到 Compose 時特別花了時間試用 Compose 的 Navigation component，終於弄清 nested graph 的意義。其實 Compose 的 Navigation component 底層都是跟 XML 版的 Navigation component 一樣，只是底層多了以 route 形式的處理。以往的說明文件在介紹 nested navigation graph 時沒有太具體說明 nested graph 背後的意義，看完之後可能覺得只是用來避免單一 XML 檔過長而拆成不同 sub-graph。但其實在 deep link 時是有特別意義。"><meta property="og:locale" content="zh-tw"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-27T21:30:00+08:00"><meta property="article:modified_time" content="2022-07-27T21:30:00+08:00"><meta property="article:tag" content="Android"><meta property="article:tag" content="Jetpack Compose"><meta name=twitter:card content="summary"><meta name=twitter:title content="Jetpack Compose Navigation component sub-graph"><meta name=twitter:description content="這次遷移到 Compose 時特別花了時間試用 Compose 的 Navigation component，終於弄清 nested graph 的意義。其實 Compose 的 Navigation component 底層都是跟 XML 版的 Navigation component 一樣，只是底層多了以 route 形式的處理。以往的說明文件在介紹 nested navigation graph 時沒有太具體說明 nested graph 背後的意義，看完之後可能覺得只是用來避免單一 XML 檔過長而拆成不同 sub-graph。但其實在 deep link 時是有特別意義。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://eric.swiftzer.net/posts/"},{"@type":"ListItem","position":2,"name":"Jetpack Compose Navigation component sub-graph","item":"https://eric.swiftzer.net/2022/07/jetpack-compose-navigation-component-sub-graph/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Jetpack Compose Navigation component sub-graph","name":"Jetpack Compose Navigation component sub-graph","description":"這次遷移到 Compose 時特別花了時間試用 Compose 的 Navigation component，終於弄清 nested graph 的意義。其實 Compose 的 Navigation component 底層都是跟 XML 版的 Navigation component 一樣，只是底層多了以 route 形式的處理。以往的說明文件在介紹 nested navigation graph 時沒有太具體說明 nested graph 背後的意義，看完之後可能覺得只是用來避免單一 XML 檔過長而拆成不同 sub-graph。但其實在 deep link 時是有特別意義。\n","keywords":["Android","Jetpack Compose"],"articleBody":"這次遷移到 Compose 時特別花了時間試用 Compose 的 Navigation component，終於弄清 nested graph 的意義。其實 Compose 的 Navigation component 底層都是跟 XML 版的 Navigation component 一樣，只是底層多了以 route 形式的處理。以往的說明文件在介紹 nested navigation graph 時沒有太具體說明 nested graph 背後的意義，看完之後可能覺得只是用來避免單一 XML 檔過長而拆成不同 sub-graph。但其實在 deep link 時是有特別意義。\n接下來會用例子示範 nested graph 在 navigation 時出現的不同效果。首先放上在 NavHost 各頁會用到的 Screen composable function，它會顯示文字和按鈕，用來顯示當前頁面的 route 和按下按鈕時會轉到另一頁。\n@Composable fun Screen( name: String, onClick: (() -\u003e Unit)? = null, secondaryOnClick: (() -\u003e Unit)? = null, ) { Column { Text(text = name) if (onClick != null) { Button(onClick = onClick) { Text(text = \"next screen\") } } if (secondaryOnClick != null) { Button(onClick = secondaryOnClick) { Text(text = \"secondary button\") } } } } 接下來就是 navigation graph。\nval navController = rememberNavController() NavHost( modifier = modifier, navController = navController, startDestination = \"top\", ) { composable(route = \"top\") { Screen( name = \"top\", onClick = { navController.navigate(\"partA\") }, secondaryOnClick = { navController.navigate(\"b3\") }, ) } navigation(startDestination = \"a1\", route = \"partA\") { composable(route = \"a1\") { Screen(name = \"a1\") { navController.navigate(\"a2\") } } composable(route = \"a2\") { Screen(name = \"a2\") { navController.navigate(\"a3\") } } composable(route = \"a3\") { Screen( name = \"a3\", onClick = { navController.navigate(\"partB\") }, secondaryOnClick = { val intents = navController.createDeepLink() .addDestination(\"b3\") .createTaskStackBuilder() .intents navController.handleDeepLink(intents.first()) }, ) } } navigation(startDestination = \"b1\", route = \"partB\") { composable(route = \"b1\") { Screen(name = \"b1\") } navigation(startDestination = \"b2\", route = \"partB2\") { composable(route = \"b2\") { Screen(name = \"b2\") } composable(route = \"b3\") { Screen(name = \"b3\") } } } } 先看首頁 top，按 top 的「next screen」按鈕能進入 a1 頁，因為 a1 是 partA sub-graph 的 start destination。其實在這個情況下可以把 onClick lambda 寫成 navController.navigate(\"a1\") 都是一樣效果。如果一直按「next screen」按鈕就會順序進入 a1 ➔ a2 ➔ a3 ➔ b1 頁。按 back 掣就能由 b2 沿路回到 a1，最後結束 Activity（假設 NavHost 是放在 Activity）。\n這個看起來沒甚麼特別。之後換成在 top 按「secondary button」鈕能的話就會直接進入 b3 頁，按 back 掣一次就會回到 top。\n接着在 top 頁一直按「next screen」按鈕直到看到 a3 頁時按「secondary button」按鈕，你會發現它進了 b3 頁。這時你再按 back 掣就會看到它回到 b2 ➔ b1 ➔ top。a3 頁的 secondaryOnClick 用了 deep link 做轉頁，所以當前的 back stack 會被清空，然後換成適用於 b3 頁的 back stack。而這個 back stack 的生成方法是看 b3 頁所屬的 sub-graph (partB2) 的 start destination (b2)，所以 b3 的上一頁是 b2 頁。而 b2 頁的上一頁就是看它所屬的 sub-graph (partB) 的 start destination (b1)。按照同一原理 b2 頁的上一頁就是 top 頁。\n如果我們把 top 的 secondaryOnClick 改為用 deep link 形式進入 a3 頁（即是改成下面的 code），你會看到它的 back stack 是 a3 ➔ a1 ➔ top。沒有 a2 是因為 a3 的 sub-graph partA 的 start destination 是 a1。換句話說 a1、a2、a3 都是平級。\ncomposable(route = \"top\") { Screen( name = \"top\", onClick = { navController.navigate(\"partA\") }, secondaryOnClick = { val intents = navController.createDeepLink() .addDestination(\"a3\") .createTaskStackBuilder() .intents navController.handleDeepLink(intents.first()) }, ) } 所以 sub-graph 的作用是在 deep linking 時控制 back stack，這種寫法是確保 Navigation component 能掌握該頁的上一頁，並且只有一頁能做上一頁（簡單來說是退路）。如果不是 deep linking 的話其實你可以隨便轉去整個 navigation graph 內的任何一頁，只要你知道它的 route 就可以了。另外，deep linking 不一定要配 URI（要在 AndroidManifest.xml 加上 intent-filter 那種），剛才例子的寫法是不用加 intent-filter。如果你要在某個很深層的頁面跳轉去另一個深層的頁面，用這個寫法會比每次特意控制 pop back stack 更加自然。當然，如果你是用 URI 那種 deep linking 的話，sub-graph 就是控制 deep link 開 app 後所造出來的 back stack。\n","wordCount":"1200","inLanguage":"zh-tw","datePublished":"2022-07-27T21:30:00+08:00","dateModified":"2022-07-27T21:30:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://eric.swiftzer.net/2022/07/jetpack-compose-navigation-component-sub-graph/"},"publisher":{"@type":"Organization","name":"EricLog","logo":{"@type":"ImageObject","url":"https://eric.swiftzer.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://eric.swiftzer.net/ accesskey=h title="EricLog (Alt + H)">EricLog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://eric.swiftzer.net/fonts/ title=Fonts><span>Fonts</span></a></li><li><a href=https://eric.swiftzer.net/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://eric.swiftzer.net/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://eric.swiftzer.net/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://eric.swiftzer.net/>首頁</a>&nbsp;»&nbsp;<a href=https://eric.swiftzer.net/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Jetpack Compose Navigation component sub-graph</h1><div class=post-meta><span title='2022-07-27 21:30:00 +0800 +0800'>July 27, 2022</span></div></header><div class=post-content><p>這次<a href=https://eric.swiftzer.net/2022/07/jetpack-compose-migration-1/>遷移到 Compose</a> 時特別花了時間試用 Compose 的 Navigation component，終於弄清 nested graph 的意義。其實 Compose 的 Navigation component 底層都是跟 XML 版的 Navigation component 一樣，只是底層多了以 route 形式的處理。以往的說明文件在介紹 <a href=https://developer.android.com/guide/navigation/navigation-nested-graphs>nested navigation graph</a> 時沒有太具體說明 nested graph 背後的意義，看完之後可能覺得只是用來避免單一 XML 檔過長而拆成不同 sub-graph。但其實在 deep link 時是有特別意義。</p><p>接下來會用例子示範 nested graph 在 navigation 時出現的不同效果。首先放上在 <code>NavHost</code> 各頁會用到的 <code>Screen</code> composable function，它會顯示文字和按鈕，用來顯示當前頁面的 route 和按下按鈕時會轉到另一頁。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nd>@Composable</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>Screen</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>onClick</span><span class=p>:</span> <span class=p>(()</span> <span class=o>-&gt;</span> <span class=n>Unit</span><span class=p>)?</span> <span class=p>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>secondaryOnClick</span><span class=p>:</span> <span class=p>(()</span> <span class=o>-&gt;</span> <span class=n>Unit</span><span class=p>)?</span> <span class=p>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Column</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Text</span><span class=p>(</span><span class=n>text</span> <span class=p>=</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>onClick</span> <span class=o>!=</span> <span class=k>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Button</span><span class=p>(</span><span class=n>onClick</span> <span class=p>=</span> <span class=n>onClick</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>Text</span><span class=p>(</span><span class=n>text</span> <span class=p>=</span> <span class=s2>&#34;next screen&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>secondaryOnClick</span> <span class=o>!=</span> <span class=k>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Button</span><span class=p>(</span><span class=n>onClick</span> <span class=p>=</span> <span class=n>secondaryOnClick</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>Text</span><span class=p>(</span><span class=n>text</span> <span class=p>=</span> <span class=s2>&#34;secondary button&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>接下來就是 navigation graph。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>val</span> <span class=py>navController</span> <span class=p>=</span> <span class=n>rememberNavController</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>NavHost</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>modifier</span> <span class=p>=</span> <span class=n>modifier</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>navController</span> <span class=p>=</span> <span class=n>navController</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>startDestination</span> <span class=p>=</span> <span class=s2>&#34;top&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>composable</span><span class=p>(</span><span class=n>route</span> <span class=p>=</span> <span class=s2>&#34;top&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Screen</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;top&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>onClick</span> <span class=p>=</span> <span class=p>{</span> <span class=n>navController</span><span class=p>.</span><span class=n>navigate</span><span class=p>(</span><span class=s2>&#34;partA&#34;</span><span class=p>)</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=n>secondaryOnClick</span> <span class=p>=</span> <span class=p>{</span> <span class=n>navController</span><span class=p>.</span><span class=n>navigate</span><span class=p>(</span><span class=s2>&#34;b3&#34;</span><span class=p>)</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>navigation</span><span class=p>(</span><span class=n>startDestination</span> <span class=p>=</span> <span class=s2>&#34;a1&#34;</span><span class=p>,</span> <span class=n>route</span> <span class=p>=</span> <span class=s2>&#34;partA&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>composable</span><span class=p>(</span><span class=n>route</span> <span class=p>=</span> <span class=s2>&#34;a1&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Screen</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;a1&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=n>navController</span><span class=p>.</span><span class=n>navigate</span><span class=p>(</span><span class=s2>&#34;a2&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>composable</span><span class=p>(</span><span class=n>route</span> <span class=p>=</span> <span class=s2>&#34;a2&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Screen</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;a2&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=n>navController</span><span class=p>.</span><span class=n>navigate</span><span class=p>(</span><span class=s2>&#34;a3&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>composable</span><span class=p>(</span><span class=n>route</span> <span class=p>=</span> <span class=s2>&#34;a3&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Screen</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;a3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>onClick</span> <span class=p>=</span> <span class=p>{</span> <span class=n>navController</span><span class=p>.</span><span class=n>navigate</span><span class=p>(</span><span class=s2>&#34;partB&#34;</span><span class=p>)</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=n>secondaryOnClick</span> <span class=p>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>val</span> <span class=py>intents</span> <span class=p>=</span> <span class=n>navController</span><span class=p>.</span><span class=n>createDeepLink</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                        <span class=p>.</span><span class=n>addDestination</span><span class=p>(</span><span class=s2>&#34;b3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>.</span><span class=n>createTaskStackBuilder</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                        <span class=p>.</span><span class=n>intents</span>
</span></span><span class=line><span class=cl>                    <span class=n>navController</span><span class=p>.</span><span class=n>handleDeepLink</span><span class=p>(</span><span class=n>intents</span><span class=p>.</span><span class=n>first</span><span class=p>())</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>navigation</span><span class=p>(</span><span class=n>startDestination</span> <span class=p>=</span> <span class=s2>&#34;b1&#34;</span><span class=p>,</span> <span class=n>route</span> <span class=p>=</span> <span class=s2>&#34;partB&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>composable</span><span class=p>(</span><span class=n>route</span> <span class=p>=</span> <span class=s2>&#34;b1&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=n>Screen</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;b1&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>navigation</span><span class=p>(</span><span class=n>startDestination</span> <span class=p>=</span> <span class=s2>&#34;b2&#34;</span><span class=p>,</span> <span class=n>route</span> <span class=p>=</span> <span class=s2>&#34;partB2&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>composable</span><span class=p>(</span><span class=n>route</span> <span class=p>=</span> <span class=s2>&#34;b2&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=n>Screen</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;b2&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>composable</span><span class=p>(</span><span class=n>route</span> <span class=p>=</span> <span class=s2>&#34;b3&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=n>Screen</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;b3&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>先看首頁 <code>top</code>，按 <code>top</code> 的「next screen」按鈕能進入 <code>a1</code> 頁，因為 <code>a1</code> 是 <code>partA</code> sub-graph 的 start destination。其實在這個情況下可以把 <code>onClick</code> lambda 寫成 <code>navController.navigate("a1")</code> 都是一樣效果。如果一直按「next screen」按鈕就會順序進入 <code>a1</code> ➔ <code>a2</code> ➔ <code>a3</code> ➔ <code>b1</code> 頁。按 back 掣就能由 <code>b2</code> 沿路回到 <code>a1</code>，最後結束 <code>Activity</code>（假設 <code>NavHost</code> 是放在 <code>Activity</code>）。</p><p>這個看起來沒甚麼特別。之後換成在 <code>top</code> 按「secondary button」鈕能的話就會直接進入 <code>b3</code> 頁，按 back 掣一次就會回到 <code>top</code>。</p><p>接着在 <code>top</code> 頁一直按「next screen」按鈕直到看到 <code>a3</code> 頁時按「secondary button」按鈕，你會發現它進了 <code>b3</code> 頁。這時你再按 back 掣就會看到它回到 <code>b2</code> ➔ <code>b1</code> ➔ <code>top</code>。<code>a3</code> 頁的 <code>secondaryOnClick</code> 用了 deep link 做轉頁，所以當前的 back stack 會被清空，然後換成適用於 <code>b3</code> 頁的 back stack。而這個 back stack 的生成方法是看 <code>b3</code> 頁所屬的 sub-graph (<code>partB2</code>) 的 start destination (<code>b2</code>)，所以 <code>b3</code> 的上一頁是 <code>b2</code> 頁。而 <code>b2</code> 頁的上一頁就是看它所屬的 sub-graph (<code>partB</code>) 的 start destination (<code>b1</code>)。按照同一原理 <code>b2</code> 頁的上一頁就是 <code>top</code> 頁。</p><p>如果我們把 <code>top</code> 的 <code>secondaryOnClick</code> 改為用 deep link 形式進入 <code>a3</code> 頁（即是改成下面的 code），你會看到它的 back stack 是 <code>a3</code> ➔ <code>a1</code> ➔ <code>top</code>。沒有 <code>a2</code> 是因為 <code>a3</code> 的 sub-graph <code>partA</code> 的 start destination 是 <code>a1</code>。換句話說 <code>a1</code>、<code>a2</code>、<code>a3</code> 都是平級。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=n>composable</span><span class=p>(</span><span class=n>route</span> <span class=p>=</span> <span class=s2>&#34;top&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Screen</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;top&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>onClick</span> <span class=p>=</span> <span class=p>{</span> <span class=n>navController</span><span class=p>.</span><span class=n>navigate</span><span class=p>(</span><span class=s2>&#34;partA&#34;</span><span class=p>)</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>secondaryOnClick</span> <span class=p>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>val</span> <span class=py>intents</span> <span class=p>=</span> <span class=n>navController</span><span class=p>.</span><span class=n>createDeepLink</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=p>.</span><span class=n>addDestination</span><span class=p>(</span><span class=s2>&#34;a3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>.</span><span class=n>createTaskStackBuilder</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=p>.</span><span class=n>intents</span>
</span></span><span class=line><span class=cl>            <span class=n>navController</span><span class=p>.</span><span class=n>handleDeepLink</span><span class=p>(</span><span class=n>intents</span><span class=p>.</span><span class=n>first</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>所以 sub-graph 的作用是在 deep linking 時控制 back stack，這種寫法是確保 Navigation component 能掌握該頁的上一頁，並且只有一頁能做上一頁（簡單來說是退路）。如果不是 deep linking 的話其實你可以隨便轉去整個 navigation graph 內的任何一頁，只要你知道它的 route 就可以了。另外，deep linking 不一定要配 URI（要在 <em>AndroidManifest.xml</em> 加上 <code>intent-filter</code> 那種），剛才例子的寫法是不用加 <code>intent-filter</code>。如果你要在某個很深層的頁面跳轉去另一個深層的頁面，用這個寫法會比每次特意控制 pop back stack 更加自然。當然，如果你是用 URI 那種 deep linking 的話，sub-graph 就是控制 deep link 開 app 後所造出來的 back stack。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://eric.swiftzer.net/tags/android/>Android</a></li><li><a href=https://eric.swiftzer.net/tags/jetpack-compose/>Jetpack Compose</a></li></ul><nav class=paginav><a class=prev href=https://eric.swiftzer.net/2023/01/android-13-per-app-language-preferences/><span class=title>« 上一頁</span><br><span>Android 13 Per-app Language Preferences</span>
</a><a class=next href=https://eric.swiftzer.net/2022/07/jetpack-compose-migration-2/><span class=title>下一頁 »</span><br><span>Jetpack Compose 遷移 (2)</span></a></nav></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//efilm.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://eric.swiftzer.net/>EricLog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="複製";function s(){t.innerHTML="已複製！",setTimeout(()=>{t.innerHTML="複製"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>